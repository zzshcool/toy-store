# 【一抽入魂線上抽】專案升級規格書 (v3.0 - Final)

本文件詳列了將現有專案轉型為「一抽入魂」專業線上抽獎平台的技術規格、市場背景、UI/UX 互動流程及安全防禦規範。

## 1. 專案背景與市場現況

### A. 客戶背景

- **主要客戶**: 【一抽入魂】 ([goneintothesoul.com.tw](https://www.goneintothesoul.com.tw/))
- **規模**: 已具備 **20,000+** 實體/線上會員與多家實體門市背景。
- **定位**: 結合線下實力，打造更公平、更具沉浸感的線上抽獎平台「一抽入魂線上抽」。

### B. 競品分析與差異化

- **參考對象**: [Wonderful Toy](https://wonderful-toy.com/), [Kuji Hunter](https://kujihunter.com/), [Slime Toy](https://slimetoy.com.tw/), [OneOne](https://www.oneone.com.tw/)。
- **優勢策略**:
    1. **極致互動**: 實現比對手更擬真的撕票與咪牌效果。
    2. **安全可靠**: 引入代碼級限流防禦自動化攻擊。
    3. **積分回饋**: 建立深度的積分商店體系與現有 2 萬會員連結。

## 2. UI/UX 詳細規格 (前端互動核心)

### A. 關於我們 (About) & 常見問題 (FAQ)

- **參考設計**: [Wonderful Toy About](https://wonderful-toy.com/about/) / [FAQ](https://wonderful-toy.com/faq/)
- **UI 需求**:
  - 使用**多層次捲動區塊**介紹實體門市與「公平抽獎」流程。
  - FAQ 需支援**分類展開式 (Accordion)** 結構。
  - **聯絡我們**: 提供表單、LINE 官方與 FB 粉專連結。

### B. 代幣儲值 (Points Deposit)

- **參考設計**: [Wonderful Toy Points](https://wonderful-toy.com/points/)
- **UI 需求**:
  - **階梯式卡片**: 顯示 100,200,300,500,1000,2000,5000,10000 等儲值方案及其對應額外贈分。
  - **錢包儀表板**: 醒目顯示當前代幣與積分餘額。

### A. 一番賞系統 (Ichiban Kuji) - 精品化互動

- **列表頁 (IP 選購)**:
  - 展示眾多 IP 商品項目。
  - 圖片右上角顯示「剩餘套數/總套數」標記（如：尚有 2 套）。
  - 底部顯示品名與價格（特價需醒目顯示）。
- **選號階段 (籤紙網格)**:
  - 渲染完整的抽獎箱網格，僅顯示尚未被抽取的號碼。
  - **自選模式**: 會員可點選一至多張「心儀號碼」。
  - **電腦選號 (隨機模式)**: 提供快捷彈窗，讓玩家快速選擇隨機抽取 **1, 3, 5, 8, 10** 張籤紙。
- **試抽功能 (Trial)**: 支援全系統試抽體驗，包含選號、隨機選號與揭曉動畫。
- **揭曉特效**:
    1. **進入全螢幕撕票**: 模擬實體揭籤。
    2. **咪牌 (Peek) 效果**: 支援滑動模擬「慢慢撕開」的期待感。
    3. **中獎動效**: 大獎出現時伴隨震動與亮眼動效 (GSAP)。
- **餘額與扣款流**:
  - **購買確認碼**: 彈窗顯示已選號碼清單、商品原價、實付金額、折抵細節及預計餘額。
  - **支付檢查**: 若代幣不足，系統需彈出 Toast 提示「代幣餘額不足，將導向充值頁面」，並於數秒後**自動跳轉**至代幣儲值介面。

### D. 動漫周邊 (動態格數 / 盲盒系統)

- **重構邏輯**: 支持 **1-N 個動態格數**（根據盲盒中盒數量生成）。
- **特點流程 (購買模式)**:
  - **單抽 (Single Pick)**: 會員可從網格中手動點選一個未拆盲盒。
  - **全包 (Full Box)**: 一次購買整中盒（含所有獎項），具備價格優惠與獨立確認彈窗。
  - **端包 (Batch Buy)**: 一次購買多盒或剩餘所有，適用於清空當前池子。
- **互動深度 (單抽流程)**:
  - **道具卡支援 (Power-ups)**:
    - **提示卡**: 點擊後縮小獎項範圍（遮碼處理）。
    - **透視卡**: 短暫查看內容物細節。
    - **換一盒**: 若不滿意當前選擇，可消耗道具重選。
  - **倒數揭曉 (Count Down)**: 選擇後進入 **180s (或自定義)** 倒數確認期，玩家可在此期間決定【就買它】或放棄。
- **天選抽 (God's Choice)**: 提供電腦自動隨機選號功能，適用於快速購買。
- **試抽功能**: 提供模擬選購與道具使用流程體驗。
- **盒櫃整合**: 盲盒購買後自動進入「玩家盒櫃」，需手動操作發貨。

### E. 擬真扭蛋機優化 (Gacha Styling)

- **視覺需求**: [Slime Toy 擬真風格](https://slimetoy.com.tw/gacha/detail/175)。
- **互動流程**:
    1. **機台造型**: 渲染典型的 3D 質感扭蛋機體。
    2. **開扭動畫**: 點擊「開扭」按鍵 -> **把手旋轉動畫** -> 零件聲效。
    3. **掉落動畫**: 扭蛋從出口滾落 -> **點擊扭蛋破殼** -> 出現獎賞。
    4. **試轉區**: 提供無消耗試玩區供會員體驗。

### F. 積分兌換商店 (Points Shop)

- **名詞變更**: 全站原有「碎片 (Shard)」全面更名為「**積分 (Points)**」。
- **頁面定義**: 獨立於現金商城，作為抽獎忠誠度回饋的限定取貨區。

## 3. 技術架構與安全防禦 (Technical & Security)

針對 2 萬人規模及防止攻擊之設計：

### A. 系統架構

- **本地緩存 (Local Cache)**: 使用 `Caffeine` 緩存熱門活動與系統設定。
- **流量加速**: 整合 **Cloudflare** 進行邊緣緩存、CDN 及基本的 DDoS 防禦。
- **數據完整性**: 使用 JPA 樂觀鎖/悲觀鎖確保「一號一籤」不重複中獎。

### B. 代碼級安全防禦 (Anti-Automation)

- **接口限流 (Rate Limiting)**: 針對抽獎 API 實施 IP + MemberID 頻率控制（如：每秒限 1 請求）。
- **防自動化腳本**:
  - 操作路徑隨機偏移監控。
  - 連續高頻操作自動觸發 **Captcha (驗證碼)**。
  - 關鍵數據庫更新前檢索 User-Agent 與行為指紋。

## 4. 專案里程碑

1. **Phase 1**: 品牌重塑 (LOGO/色系/積分名詞更動) 與 安全限流框架模組開發。
2. **Phase 2**: 核心互動升級 (視覺扭蛋機開發、一番賞選號與咪牌動畫實作)。
3. **Phase 3**: 靜態頁面與 FAQ/About/Contact 建立。
4. **Phase 4**: 網站上線測試、併發壓力測試及 Cloudflare 防禦整合。

---
*文件修訂日期: 2025-12-22*
*總設計師: Senior E-commerce Engineer*

## 9. 購買確認彈窗規範 (Order Confirmation Modal) - 反向分析

本章節參照「點擊購買前確認畫面」截圖，制定抽獎/購買前的二次確認彈窗規範。

### A. 彈窗視覺佈局 (Modal Layout)

- **背景層**: 半透明黑色遮罩，核心彈窗採白色大圓角容器。
- **商品資訊區**:
  - 左側顯示商品縮圖（帶圓角）。
  - 右側顯示「商品名稱」、「價格 (紅色醒目)」、「代幣餘額」。
- **操作說明文案**: 居中文字提示：「確定要購買此商品嗎？購買後將扣除相應代幣並進行轉蛋。」
- **折抵選擇區**:
  - **紅利折抵**: 顯示當前紅利餘額，並提供輸入/選擇區塊（如：紅利不足提示）。
  - **優惠券**: 整合「選擇優惠券 >」入口，點擊開啟二層或彈窗列表。
- **結算清單區 (Summary Box)**: 淺灰色背景圓角容器。
  - 列出：商品價格、**實付金額 (紅色粗體)**、代幣餘額 (交易後)。

### B. 互動與驗證邏輯

- **餘額檢查**: 若「代幣餘額 < 實付金額」，【確認購買】按鈕應維持不可點擊狀態，或點擊後彈出「代幣不足，請先儲值」之引導。
- **折抵運算**: 實付金額 = 商品價格 - (紅利折抵/匯率) - 優惠券面額（需符合最低消費門檻）。
- **確認按鈕**: 底部醒目紅色全寬圓角按鈕【確認購買】。

### C. 沉浸式體驗要求

- **無跳轉設計**: 此彈窗必須以 AJAX / 動態 Component 形式出現於當前頁面上層。
- **觸控優化**: 按鈕與折抵區塊需具備足夠的點擊高度（min-height: 48px），方便手機單手操作。

## 8. 會員中心與資產管理 UI 規範 (示意圖反向分析)

根據用戶提供的 5 張核心示意圖，反向拆解並制定以下 UI/UX 實作規範：

### A. 會員中心主頁 (Member Home)

- **視覺資產儀表板**: 頂部區塊需包含「頭貼、暱稱/手機號、VIP 等級標籤」。
- **核心數據列**: 四大資產指標（盒櫃、代幣、紅利、優惠券）採水平排列，支持點擊跳轉詳情。
- **功能九宮格**:
  - **第一層**: 道具卡、我的最愛、抽獎紀錄、聯絡客服。
  - **第二層 (我的訂單)**: 採流程化圖示顯示「待付款、待出貨、配送中、已完成」。
- **會員碼**: 右上角提供 QR Code 或條碼快捷入口。

### B. 等級與特權視覺化 (VIP Privileges)

- **進度條設計**: 顯示當前等級（如 VIP1 青銅）、當前成長值與目標保級/升級值（如 5 / 2,500）。
- **特權圖示**: 多彩圖示化顯示「消費返利 (%)、紅利兌換、道具卡、優惠券、免運券」。
- **快速提升引導**: 提供「抽一番賞、逛商城」等醒目 Banner 導流。

### C. 任務與簽到系統 (Task & Check-in)

- **分頁切換**: 提供「每日任務、每週任務、每月任務」標籤切換。
- **每日簽到**:
  - 7 日連續簽到 UI。
  - 獎勵級距：第 3 天 (雙倍)、第 5 天 (三倍)、第 7 天 (神祕禮包/五倍)。
  - 狀態顯示：區分「已領取、可簽到、鎖定中」。
- **任務列表**: 卡片式設計，顯示任務名（如：使用提示卡 0/1）、獎勵（成長值 +5）及【前往】按鈕。

### D. 代幣儲值介面 (Token Deposit UI)

- **餘額顯示**: 頂部背景區塊醒目顯示「當前代幣：$0」。
- **面額選擇**:
  - 階梯式按鈕：100, 200, 300, 500, 1000, 2000, 3000, 4000, 5000, 10000, 15000, 20000, 50000, 80000。
  - 選中狀態：需具備明顯的色塊包圍（視覺強調）。
- **電子發票**: 整合二聯式/載具選擇入口。
- **底端固定按鈕**: 全寬【購買】按鈕，確保行動端易於點擊。

### E. 帳戶與系統設定 (Account Settings)

- **清單式設計**:
  - **帳戶設定**: 基本設定、收貨地址、電子發票與載具。
  - **關於與協議**: 關於我們、會員條款、隱私權政策、聯絡我們、退換貨資訊。
- **退出功能**: 底部獨立黑色或醒目按鈕執行【登出】。

## 10. 全域規則說明彈窗 (Global Rules Pop-up)

針對全系統所有抽獎模組（一番賞、盲盒、扭蛋），必須具備「規則說明」入口。

- **觸發機制**: 玩家點選頁面上的規則說明按鈕，即以 **Modal 彈窗** 形式彈出，**無需換頁**。
- **內容規格**:
  - **訂單查詢**: 引導至【會員中心 > 我的訂單】。
  - **拆袋說明**: 說明是否拆原盒發貨（依品牌方規定）。
  - **出貨時間**: 承諾訂單完成後 3 個工作天內出貨。
  - **免運條件**: 規範盒櫃滿 5 件免運，未滿則需額外運費。
  - **紅利與道具**: 說明紅利折抵門檻（如：滿 1,000 點可抵）及道具卡使用時機。
  - **售後與退換**: 強調機率性抽取商品「不適用七日無條件退貨」。

## 3. UI/UX 與各系統互動細節

### A. 一番賞系統 (Ichiban Kuji) - 精品化互動

- **規則功能追加**: 頁面需具備浮動或固定入口點擊彈出【規則說明】Modal。

### D. 動漫周邊 (動態格數 / 盲盒系統)

- **互動深度 (單抽流程) - 步驟拆解**:
  - **第一步：挑選盒玩**: 從任一尚未拆封的盒玩中選擇，支援單抽或整盒全購。
  - **第二步：使用道具 (揭曉前)**:
    - **提示卡**: 獲得內容物提示，縮小範圍（如：剔除一個等級）。
    - **透視卡**: 直接查看當前盒玩具體內容物。
    - **換一盒**: 隨機更換為中盒內任一盒，道具效果不保留。
  - **第三步：獲得結果**: 中獎商品即時顯示，並同步存入系統「盒櫃」。
  - **第四步：發貨申請**: 進入【會員中心 > 盒櫃】。滿五件免運，不限類型。

### E. 擬真扭蛋機優化 (Gacha Styling)

- **詳情頁 UI 佈局 (高互動版)**:
  - **儀表板**: 顯示品名、價格（如 $135）、庫存量（如 120）。
  - **機體重心**: 3D 質感扭蛋機主圖。
  - **三合一控制列**:
    - **去玩具櫃 (左側按鈕)**: 快速跳轉至盒櫃查看已得獎賞。
    - **立即購買 (中央大鈕)**: 黃色圓角矩形，觸發二次確認彈窗。
    - **試一試 (右側按鈕)**: 進入模擬抽獎模式（無代幣消耗）。
  - **我的收集 (底部 Bar)**: 顯示當前系列已搜集進度（如：我的收集 0/5）。

## 11. 簽到與任務活動中心 (Check-in & Missions)

整合會員資產、每日福利與活躍度成長。

### A. VIP 資產儀表板 (VIP Dashboard)

- **卡片式設計**: 頂端滑動切換 VIP1-VIP10 卡面。
- **數據展示**: 顯示當前等級成長值進度條、當前等級已解鎖特權（如：消費返利比例、專屬優惠券）。

### B. 7 日連續簽到系統

- **階梯獎勵機制**:
  - 第 1, 2, 4 天：基礎紅利。
  - **雙倍獎勵 (第 3 天)**: 多倍紅利。
  - **三倍獎勵 (第 5 天)**: 靈魂紅利。
  - **神秘大禮 (第 7 天)**: 含高額紅利或專屬道具。
- **UI 表現**: 已簽到日期顯示綠色勾選，當前日期高亮導引，底部按鈕顯示已獲得總額。

### C. 階梯任務體系 (Mission Wall)

- **分類標籤**: 每日任務、每週任務、每月任務。
- **任務類型與回饋**:
  - 任務內容：使用提示卡、成功購買(番/盒/蛋)、成功簽到等。
  - 獎勵掛鉤：完成後即時領取成長值 (+5/25) 或紅利。

## 12. 消息與通知系統 (Messaging System)

- **列表排版**:
  - **標題與圖示**: 根據消息類型（系統獎勵 🎁、公告 📢、物流 🚚）區分 Icon。
  - **時間戳記**: 顯示精確至秒的發佈時間。
- **消息分類**:
  - **系統獎勵**: 註冊禮、活動贈點。
  - **運營公告**: 運費調整、金流異動、延遲交付通知。
  - **物流更新**: 特定商品到貨通知、出貨提醒。

## 13. 商品完售與透明化機制 (Sold Out & Transparency)

### A. 全站完售視覺覆蓋 (Global Sold Out Overlay)

- **列表呈現**: 商品格子需覆蓋圓形紅色「**完售**」浮水印圖章。
- **狀態鎖定**: 鎖定進入詳情頁或置底按鈕灰化。

### B. 一番賞透明化結果頁

- **店家配率表更新**: 完售後，剩餘/總數需全部歸為 **0 / X**。
- **最後賞 (Last Award)**: 醒目置中展示最後一張籤紙獲得的限定獎項。
- **公平性驗證 (Fairness Check)**:
  - **SHA256 哈希工具連結**: 供會員驗證隨機種子。
  - **隨機種子 (TXID)**: 公開該池抽獎使用的隨機碼。
  - **種子哈希 (TXID Hash)**: 公開對應的哈希值以防作弊。
- **中獎分布網格 (Result Map)**:
  - **10xN 彩色網格**: 完整展示 01~N 號籤紙分別對應的中獎等級（A賞-H賞）。
  - **視覺化透明度**: 讓會員在完售後可回推並確認每張籤的公正性。

## 7. 會員等級與紅利點系統 (Loyalty System Technical Spec)

- **數據模型**: 需在 `Member` 實體中新增 `growthValue` (累積成長值) 及 `lastLevelReviewDate`。
- **獲取邏輯**:
  - **消費換算**: 異步監聽訂單完成事件，按 `實付金額 : 成長值 = 1 : 1` 注入。
  - **行為獎勵**: 簽到、購買商品、使用提示卡需觸發成長值 API。
- **季度結算排程 (90-Day Review Job)**:
  - **週期**: 每 90 天執行一次。
  - **VIP1-VIP4**: 採「只進不退」策略。
  - **VIP5-VIP10**: 執行保級檢查。
    - VIP5: 季度成長值 < 1,500 則降級。
    - VIP6: 季度成長值 < 3,000 則降級。
    - **VIP7-VIP10 高階保級**:
      - VIP7: 季度成長值 < 8,000 則降級。
      - VIP8: 季度成長值 < 20,000 則降級。
      - VIP9: 季度成長值 < 50,000 則降級。
      - VIP10: 季度成長值 < 100,000 則降級。
    - **保級緩衝規則**: 延續 VIP6 的邏輯，若會員累積總成長值遠超門檻（如 VIP10 總值達 1,000,000），則該季保級門檻可獲得 5% 減免，超過部分歸零但不降級。

### B. 會員等級門檻定義 (技術參考)

| 等級 | 累計成長值門檻 | 季度保級要求 | 備註 |
| :--- | :--- | :--- | :--- |
| VIP1 | 0 | - | 初始等級 |
| VIP2 | 5,000 | - | 只進不退 |
| VIP3 | 25,000 | - | 只進不退 |
| VIP4 | 50,000 | - | 只進不退 |
| VIP5 | 80,000 | 1,500 | 開始降級評估 |
| VIP6 | 150,000 | 3,000 | - |
| **VIP7** | **300,000** | **8,000** | **高階分水嶺** |
| **VIP8** | **600,000** | **20,000** | - |
| **VIP9** | **1,200,000** | **50,000** | - |
| **VIP10** | **2,500,000** | **100,000** | **頂尖殿堂** |

### B. 紅利點數系統 (Bonus Points/Bonus Points)

- **紅利獲取**:
  - **簽到贈點**: 每日簽到 API 分發。
  - **消費回饋**: 根據會員等級比例計算回饋點數，入帳於 `bonusPoints` 欄位。
- **有效期限**: 採「發放起一年」制。需實作每月最後一日的「逾期點數回收」排程。
- **折抵邏輯**:
  - **匯率**: 200 點 = 10 元。
  - **交易安全性**: 實作「預扣 -> 成功扣除 / 失敗返還」的事務機制。交易失敗需在 5-10 分鐘內觸發自動補還 Job。

### C. 會員權益自動發放 (Benefit Distribution)

- **每月發放 Job**: 每月 1 日 00:00 執行。
  - 根據當前等級分發：道具卡、優惠券、免運券。
  - 使用郵件或站內信通知會員。

### D. 售後處理

- **紅利回收**: 退貨/退款流程中需包含「逆向扣除紅利點」邏輯，防止帳戶餘額為負（若點數已使用，則從退款金額中折抵扣除）。

## 6. SlimeToy 風格佈局與排版指導 (視覺追加優化)

本章節旨在指導如何參照 [Slime Toy 史萊姆玩具](https://slimetoy.com.tw/) 的 UI/UX 風格，優化本專案的 RWD 質感。

### A. 行動端「App 化」導覽佈局

- **底部固定導覽 (Bottom Sticky Nav)**: 針對手機端玩家，必須具備底部快捷欄。
  - **分頁圖示**: 【首頁】、【扭蛋】、【一番賞】、【動漫周邊】、【會員中心】。
  - **設計**: 具備微陰影或磨砂玻璃 (Glassmorphism) 效果，確保文字與圖示清晰。
- **頂部極簡導覽**: 只保留 Logo、代幣/積分顯示及通知圖示。

### B. 商品展示佈局 (Grid & Card)

- **首頁商品流**: 採用 **2 欄位網格 (Grid 2xN)** 或 **大面積卡片流** 排版。
- **卡片細節**:
  - 圖片佔比 70% 以上，圓角設計 (Border-radius)。
  - 狀態標籤 (Status Badge): 在圖片左上/右上標註「HOT」、「NEW」、「SOLD OUT」。
  - 快速購買按鈕置於卡片右下角。

### C. 抽獎詳情頁視覺階層

- **橫向滑動獎項預覽 (Horizontal Scroll)**: 參考 SlimeToy 詳情頁，將獎項（A 賞、B 賞等）以橫向卡片形式排列，方便手機端單手左右滑動查看細節。
- **資訊優先級**: IP 商品主圖 -> 獎項分布列表 -> 視覺化籤紙/扭蛋機區域。
- **浮動操作區**: 底部固定放置【試抽】與【正式抽】按鈕，按鈕需具備顯眼且具層次感的色彩。

### D. 配色與細節美學

- **磨砂玻璃介面 (Glassmorphism)**: 在彈出視窗（如登錄、中獎結果）與底部 Bar 使用半透明模糊背景。
- **品牌一致性**: 雖然風格參考 SlimeToy，但整體配色需根據「一抽入魂」的 **黑、紅、金** 主色調進行調整，保持精品、專業的氛圍。

## 5. 行動端沉浸式體驗與全系統試抽功能 (補充需求)

### A. 全系統試抽機制 (Trial Feature)

- **核心要求**: 針對「一番賞 (C)」、「動漫周邊 (D)」、「扭蛋系統 (E)」全面導入試抽功能。
- **目的**: 讓玩家在進入正式消費前，能先行體驗一套完整且精美的抽獎動畫（選號 -> 過程 -> 揭曉），降低進入門檻。

### B. 沉浸式登錄轉換 (Seamless Conversion)

- **轉換邏輯**: 當玩家在試抽後想要正式購買（真抽），或直接進行正式抽選時，若系統檢測到未登錄，**嚴禁跳轉至獨立登錄頁**。
- **技術實現**:
  - 直接在當前頁面彈出 **登錄 / 註冊一體化 Modal 彈窗**。
  - 登錄完成後，彈窗無感關閉並直接開啟支付確認，確保玩家的視覺與情緒不被頁面跳轉打斷。

### C. 手機優先 RWD 設計 (Mobile-First UX)

- **流量比例**: 預計 9 成用戶使用行動裝置消費。
- **設計準則**:
  - **觸控優化**: 所有高互動元素（如扭蛋旋轉把手、一番賞撕票區）需具備「大點擊熱區」與「觸覺反饋感（動畫/震動）」。
  - **屏幕適配**: 確保橫幅標題、活動主圖與抽獎組件在不同尺寸手機（16:9, 19.5:9 等）下完美適配，無破版現象。
  - **沉浸感提升**: 抽獎過程中使用全屏或近全屏的層疊效果，遮蔽無關干擾資訊。
