# 【一抽入魂線上抽】專案升級規格書 (v3.0 - Final)

本文件詳列了將現有專案轉型為「一抽入魂」專業線上抽獎平台的技術規格、市場背景、UI/UX 互動流程及安全防禦規範。

## 1. 專案背景與市場現況

### A. 客戶背景

- **主要客戶**: 【一抽入魂】 ([goneintothesoul.com.tw](https://www.goneintothesoul.com.tw/))
- **規模**: 已具備 **20,000+** 實體/線上會員與多家實體門市背景。
- **定位**: 結合線下實力，打造更公平、更具沉浸感的線上抽獎平台「一抽入魂線上抽」。

### B. 競品分析與差異化

- **參考對象**: [Wonderful Toy](https://wonderful-toy.com/), [Kuji Hunter](https://kujihunter.com/), [Slime Toy](https://slimetoy.com.tw/), [OneOne](https://www.oneone.com.tw/)。
- **優勢策略**:
    1. **極致互動**: 實現比對手更擬真的撕票與咪牌效果。
    2. **安全可靠**: 引入代碼級限流防禦自動化攻擊。
    3. **積分回饋**: 建立深度的積分商店體系與現有 2 萬會員連結。

## 2. UI/UX 詳細規格 (前端互動核心)

### A. 關於我們 (About) & 常見問題 (FAQ)

- **參考設計**: [Wonderful Toy About](https://wonderful-toy.com/about/) / [FAQ](https://wonderful-toy.com/faq/)
- **UI 需求**:
  - 使用**多層次捲動區塊**介紹實體門市與「公平抽獎」流程。
  - FAQ 需支援**分類展開式 (Accordion)** 結構。
  - **聯絡我們**: 提供表單、LINE 官方與 FB 粉專連結。

### B. 代幣儲值 (Points Deposit)

- **參考設計**: [Wonderful Toy Points](https://wonderful-toy.com/points/)
- **UI 需求**:
  - **階梯式卡片**: 顯示 100,200,300,500,1000,2000,5000,10000 等儲值方案及其對應額外贈分。
  - **錢包儀表板**: 醒目顯示當前代幣與積分餘額。

### A. 一番賞系統 (Ichiban Kuji) - 精品化互動

- **列表頁 (IP 選購)**:
  - 展示眾多 IP 商品項目。
  - 圖片右上角顯示「剩餘套數/總套數」標記（如：尚有 2 套）。
  - 底部顯示品名與價格（特價需醒目顯示）。
- **選號階段 (籤紙網格)**:
  - 渲染完整的抽獎箱網格，僅顯示尚未被抽取的號碼。
  - **自選模式**: 會員可點選一至多張「心儀號碼」。
  - **電腦選號 (隨機模式)**: 提供快捷彈窗，讓玩家快速選擇隨機抽取 **1, 3, 5, 8, 10** 張籤紙。
- **試抽功能 (Trial)**: 支援全系統試抽體驗，包含選號、隨機選號與揭曉動畫。
- **揭曉特效**:
    1. **進入全螢幕撕票**: 模擬實體揭籤。
    2. **咪牌 (Peek) 效果**: 支援滑動模擬「慢慢撕開」的期待感。
    3. **中獎動效**: 大獎出現時伴隨震動與亮眼動效 (GSAP)。
- **餘額與扣款流**:
  - **購買確認碼**: 彈窗顯示已選號碼清單、商品原價、實付金額、折抵細節及預計餘額。
  - **支付檢查**: 若代幣不足，系統需彈出 Toast 提示「代幣餘額不足，將導向充值頁面」，並於數秒後**自動跳轉**至代幣儲值介面。

### D. 動漫周邊 (動態格數 / 盲盒系統)

- **重構邏輯**: 支持 **1-N 個動態格數**（根據盲盒中盒數量生成）。
- **特點流程 (購買模式)**:
  - **單抽 (Single Pick)**: 會員可從網格中手動點選一個未拆盲盒。
  - **全包 (Full Box)**: 一次購買整中盒（含所有獎項），具備價格優惠與獨立確認彈窗。
  - **端包 (Batch Buy)**: 一次購買多盒或剩餘所有，適用於清空當前池子。
- **互動深度 (單抽流程)**:
  - **道具卡支援 (Power-ups)**:
    - **提示卡**: 點擊後縮小獎項範圍（遮碼處理）。
    - **透視卡**: 短暫查看內容物細節。
    - **換一盒**: 若不滿意當前選擇，可消耗道具重選。
  - **倒數揭曉 (Count Down)**: 選擇後進入 **180s (或自定義)** 倒數確認期，玩家可在此期間決定【就買它】或放棄。
- **天選抽 (God's Choice)**: 提供電腦自動隨機選號功能，適用於快速購買。
- **試抽功能**: 提供模擬選購與道具使用流程體驗。
- **盒櫃整合**: 盲盒購買後自動進入「玩家盒櫃」，需手動操作發貨。

### E. 擬真扭蛋機優化 (Gacha Styling)

- **視覺需求**: [Slime Toy 擬真風格](https://slimetoy.com.tw/gacha/detail/175)。
- **互動流程**:
    1. **機台造型**: 渲染典型的 3D 質感扭蛋機體。
    2. **開扭動畫**: 點擊「開扭」按鍵 -> **把手旋轉動畫** -> 零件聲效。
    3. **掉落動畫**: 扭蛋從出口滾落 -> **點擊扭蛋破殼** -> 出現獎賞。
    4. **試轉區**: 提供無消耗試玩區供會員體驗。

### F. 積分兌換商店 (Points Shop)

- **名詞變更**: 全站原有「碎片 (Shard)」全面更名為「**積分 (Points)**」。
- **頁面定義**: 獨立於現金商城，作為抽獎忠誠度回饋的限定取貨區。

## 3. 技術架構與安全防禦 (Technical & Security)

針對 2 萬人規模及防止攻擊之設計：

### A. 系統架構

- **本地緩存 (Local Cache)**: 使用 `Caffeine` 緩存熱門活動與系統設定。
- **流量加速**: 整合 **Cloudflare** 進行邊緣緩存、CDN 及基本的 DDoS 防禦。
- **數據完整性**: 使用 JPA 樂觀鎖/悲觀鎖確保「一號一籤」不重複中獎。

### B. 代碼級安全防禦 (Anti-Automation)

- **接口限流 (Rate Limiting)**: 針對抽獎 API 實施 IP + MemberID 頻率控制（如：每秒限 1 請求）。
- **防自動化腳本**:
  - 操作路徑隨機偏移監控。
  - 連續高頻操作自動觸發 **Captcha (驗證碼)**。
  - 關鍵數據庫更新前檢索 User-Agent 與行為指紋。

## 4. 專案里程碑

1. **Phase 1**: 品牌重塑 (LOGO/色系/積分名詞更動) 與 安全限流框架模組開發。
2. **Phase 2**: 核心互動升級 (視覺扭蛋機開發、一番賞選號與咪牌動畫實作)。
3. **Phase 3**: 靜態頁面與 FAQ/About/Contact 建立。
4. **Phase 4**: 網站上線測試、併發壓力測試及 Cloudflare 防禦整合。

---
*文件修訂日期: 2025-12-22*
*總設計師: Senior E-commerce Engineer*

## 9. 購買確認彈窗規範 (Order Confirmation Modal) - 反向分析

本章節參照「點擊購買前確認畫面」截圖，制定抽獎/購買前的二次確認彈窗規範。

### A. 彈窗視覺佈局 (Modal Layout)

- **背景層**: 半透明黑色遮罩，核心彈窗採白色大圓角容器。
- **商品資訊區**:
  - 左側顯示商品縮圖（帶圓角）。
  - 右側顯示「商品名稱」、「價格 (紅色醒目)」、「代幣餘額」。
- **操作說明文案**: 居中文字提示：「確定要購買此商品嗎？購買後將扣除相應代幣並進行轉蛋。」
- **折抵選擇區**:
  - **紅利折抵**: 顯示當前紅利餘額，並提供輸入/選擇區塊（如：紅利不足提示）。
  - **優惠券**: 整合「選擇優惠券 >」入口，點擊開啟二層或彈窗列表。
- **結算清單區 (Summary Box)**: 淺灰色背景圓角容器。
  - 列出：商品價格、**實付金額 (紅色粗體)**、代幣餘額 (交易後)。

### B. 互動與驗證邏輯

- **餘額檢查**: 若「代幣餘額 < 實付金額」，【確認購買】按鈕應維持不可點擊狀態，或點擊後彈出「代幣不足，請先儲值」之引導。
- **折抵運算**: 實付金額 = 商品價格 - (紅利折抵/匯率) - 優惠券面額（需符合最低消費門檻）。
- **確認按鈕**: 底部醒目紅色全寬圓角按鈕【確認購買】。

### C. 沉浸式體驗要求

- **無跳轉設計**: 此彈窗必須以 AJAX / 動態 Component 形式出現於當前頁面上層。
- **觸控優化**: 按鈕與折抵區塊需具備足夠的點擊高度（min-height: 48px），方便手機單手操作。

## 8. 會員中心與資產管理 UI 規範 (示意圖反向分析)

根據用戶提供的 5 張核心示意圖，反向拆解並制定以下 UI/UX 實作規範：

### A. 會員中心主頁 (Member Home)

- **視覺資產儀表板**: 頂部區塊需包含「頭貼、暱稱/手機號、VIP 等級標籤」。
- **核心數據列**: 四大資產指標（盒櫃、代幣、紅利、優惠券）採水平排列，支持點擊跳轉詳情。
- **功能九宮格**:
  - **第一層**: 道具卡、我的最愛、抽獎紀錄、聯絡客服。
  - **第二層 (我的訂單)**: 採流程化圖示顯示「待付款、待出貨、配送中、已完成」。
- **會員碼**: 右上角提供 QR Code 或條碼快捷入口。

### B. 等級與特權視覺化 (VIP Privileges)

- **進度條設計**: 顯示當前等級（如 VIP1 青銅）、當前成長值與目標保級/升級值（如 5 / 2,500）。
- **特權圖示**: 多彩圖示化顯示「消費返利 (%)、紅利兌換、道具卡、優惠券、免運券」。
- **快速提升引導**: 提供「抽一番賞、逛商城」等醒目 Banner 導流。

### C. 任務與簽到系統 (Task & Check-in)

- **分頁切換**: 提供「每日任務、每週任務、每月任務」標籤切換。
- **每日簽到**:
  - 7 日連續簽到 UI。
  - 獎勵級距：第 3 天 (雙倍)、第 5 天 (三倍)、第 7 天 (神祕禮包/五倍)。
  - 狀態顯示：區分「已領取、可簽到、鎖定中」。
- **任務列表**: 卡片式設計，顯示任務名（如：使用提示卡 0/1）、獎勵（成長值 +5）及【前往】按鈕。

### D. 代幣儲值介面 (Token Deposit UI)

- **餘額顯示**: 頂部背景區塊醒目顯示「當前代幣：$0」。
- **面額選擇**:
  - 階梯式按鈕：100, 200, 300, 500, 1000, 2000, 3000, 4000, 5000, 10000, 15000, 20000, 50000, 80000。
  - 選中狀態：需具備明顯的色塊包圍（視覺強調）。
- **電子發票**: 整合二聯式/載具選擇入口。
- **底端固定按鈕**: 全寬【購買】按鈕，確保行動端易於點擊。

### E. 帳戶與系統設定 (Account Settings)

- **清單式設計**:
  - **帳戶設定**: 基本設定、收貨地址、電子發票與載具。
  - **關於與協議**: 關於我們、會員條款、隱私權政策、聯絡我們、退換貨資訊。
- **退出功能**: 底部獨立黑色或醒目按鈕執行【登出】。

## 10. 全域規則說明彈窗 (Global Rules Pop-up)

針對全系統所有抽獎模組（一番賞、盲盒、扭蛋），必須具備「規則說明」入口。

- **觸發機制**: 玩家點選頁面上的規則說明按鈕，即以 **Modal 彈窗** 形式彈出，**無需換頁**。
- **內容規格**:
  - **訂單查詢**: 引導至【會員中心 > 我的訂單】。
  - **拆袋說明**: 說明是否拆原盒發貨（依品牌方規定）。
  - **出貨時間**: 承諾訂單完成後 3 個工作天內出貨。
  - **免運條件**: 規範盒櫃滿 5 件免運，未滿則需額外運費。
  - **紅利與道具**: 說明紅利折抵門檻（如：滿 1,000 點可抵）及道具卡使用時機。
  - **售後與退換**: 強調機率性抽取商品「不適用七日無條件退貨」。

## 3. UI/UX 與各系統互動細節

### A. 一番賞系統 (Ichiban Kuji) - 精品化互動

- **規則功能追加**: 頁面需具備浮動或固定入口點擊彈出【規則說明】Modal。

### D. 動漫周邊 (動態格數 / 盲盒系統)

- **互動深度 (單抽流程) - 步驟拆解**:
  - **第一步：挑選盒玩**: 從任一尚未拆封的盒玩中選擇，支援單抽或整盒全購。
  - **第二步：使用道具 (揭曉前)**:
    - **提示卡**: 獲得內容物提示，縮小範圍（如：剔除一個等級）。
    - **透視卡**: 直接查看當前盒玩具體內容物。
    - **換一盒**: 隨機更換為中盒內任一盒，道具效果不保留。
  - **第三步：獲得結果**: 中獎商品即時顯示，並同步存入系統「盒櫃」。
  - **第四步：發貨申請**: 進入【會員中心 > 盒櫃】。滿五件免運，不限類型。

### E. 擬真扭蛋機優化 (Gacha Styling)

- **詳情頁 UI 佈局 (高互動版)**:
  - **儀表板**: 顯示品名、價格（如 $135）、庫存量（如 120）。
  - **機體重心**: 3D 質感扭蛋機主圖。
  - **三合一控制列**:
    - **去玩具櫃 (左側按鈕)**: 快速跳轉至盒櫃查看已得獎賞。
    - **立即購買 (中央大鈕)**: 黃色圓角矩形，觸發二次確認彈窗。
    - **試一試 (右側按鈕)**: 進入模擬抽獎模式（無代幣消耗）。
  - **我的收集 (底部 Bar)**: 顯示當前系列已搜集進度（如：我的收集 0/5）。

## 11. 簽到與任務活動中心 (Check-in & Missions)

整合會員資產、每日福利與活躍度成長。

### A. VIP 資產儀表板 (VIP Dashboard)

- **卡片式設計**: 頂端滑動切換 VIP1-VIP10 卡面。
- **數據展示**: 顯示當前等級成長值進度條、當前等級已解鎖特權（如：消費返利比例、專屬優惠券）。

### B. 7 日連續簽到系統

- **階梯獎勵機制**:
  - 第 1, 2, 4 天：基礎紅利。
  - **雙倍獎勵 (第 3 天)**: 多倍紅利。
  - **三倍獎勵 (第 5 天)**: 靈魂紅利。
  - **神秘大禮 (第 7 天)**: 含高額紅利或專屬道具。
- **UI 表現**: 已簽到日期顯示綠色勾選，當前日期高亮導引，底部按鈕顯示已獲得總額。

### C. 階梯任務體系 (Mission Wall)

- **分類標籤**: 每日任務、每週任務、每月任務。
- **任務類型與回饋**:
  - 任務內容：使用提示卡、成功購買(番/盒/蛋)、成功簽到等。
  - 獎勵掛鉤：完成後即時領取成長值 (+5/25) 或紅利。

## 12. 消息與通知系統 (Messaging System)

- **列表排版**:
  - **標題與圖示**: 根據消息類型（系統獎勵 🎁、公告 📢、物流 🚚）區分 Icon。
  - **時間戳記**: 顯示精確至秒的發佈時間。
- **消息分類**:
  - **系統獎勵**: 註冊禮、活動贈點。
  - **運營公告**: 運費調整、金流異動、延遲交付通知。
  - **物流更新**: 特定商品到貨通知、出貨提醒。

## 13. 商品完售與透明化機制 (Sold Out & Transparency)

### A. 全站完售視覺覆蓋 (Global Sold Out Overlay)

- **列表呈現**: 商品格子需覆蓋圓形紅色「**完售**」浮水印圖章。
- **狀態鎖定**: 鎖定進入詳情頁或置底按鈕灰化。

### B. 一番賞透明化結果頁

- **店家配率表更新**: 完售後，剩餘/總數需全部歸為 **0 / X**。
- **最後賞 (Last Award)**: 醒目置中展示最後一張籤紙獲得的限定獎項。
- **公平性驗證 (Fairness Check)**:
  - **SHA256 哈希工具連結**: 供會員驗證隨機種子。
  - **隨機種子 (TXID)**: 公開該池抽獎使用的隨機碼。
  - **種子哈希 (TXID Hash)**: 公開對應的哈希值以防作弊。
- **中獎分布網格 (Result Map)**:
  - **10xN 彩色網格**: 完整展示 01~N 號籤紙分別對應的中獎等級（A賞-H賞）。
  - **視覺化透明度**: 讓會員在完售後可回推並確認每張籤的公正性。

## 7. 會員等級與紅利點系統 (Loyalty System Technical Spec)

- **數據模型**: 需在 `Member` 實體中新增 `growthValue` (累積成長值) 及 `lastLevelReviewDate`。
- **獲取邏輯**:
  - **消費換算**: 異步監聽訂單完成事件，按 `實付金額 : 成長值 = 1 : 1` 注入。
  - **行為獎勵**: 簽到、購買商品、使用提示卡需觸發成長值 API。
- **季度結算排程 (90-Day Review Job)**:
  - **週期**: 每 90 天執行一次。
  - **VIP1-VIP4**: 採「只進不退」策略。
  - **VIP5-VIP10**: 執行保級檢查。
    - VIP5: 季度成長值 < 1,500 則降級。
    - VIP6: 季度成長值 < 3,000 則降級。
    - **VIP7-VIP10 高階保級**:
      - VIP7: 季度成長值 < 8,000 則降級。
      - VIP8: 季度成長值 < 20,000 則降級。
      - VIP9: 季度成長值 < 50,000 則降級。
      - VIP10: 季度成長值 < 100,000 則降級。
    - **保級緩衝規則**: 延續 VIP6 的邏輯，若會員累積總成長值遠超門檻（如 VIP10 總值達 1,000,000），則該季保級門檻可獲得 5% 減免，超過部分歸零但不降級。

### B. 會員等級門檻定義 (技術參考)

| 等級 | 累計成長值門檻 | 季度保級要求 | 備註 |
| :--- | :--- | :--- | :--- |
| VIP1 | 0 | - | 初始等級 |
| VIP2 | 5,000 | - | 只進不退 |
| VIP3 | 25,000 | - | 只進不退 |
| VIP4 | 50,000 | - | 只進不退 |
| VIP5 | 80,000 | 1,500 | 開始降級評估 |
| VIP6 | 150,000 | 3,000 | - |
| **VIP7** | **300,000** | **8,000** | **高階分水嶺** |
| **VIP8** | **600,000** | **20,000** | - |
| **VIP9** | **1,200,000** | **50,000** | - |
| **VIP10** | **2,500,000** | **100,000** | **頂尖殿堂** |

### B. 紅利點數系統 (Bonus Points/Bonus Points)

- **紅利獲取**:
  - **簽到贈點**: 每日簽到 API 分發。
  - **消費回饋**: 根據會員等級比例計算回饋點數，入帳於 `bonusPoints` 欄位。
- **有效期限**: 採「發放起一年」制。需實作每月最後一日的「逾期點數回收」排程。
- **折抵邏輯**:
  - **匯率**: 200 點 = 10 元。
  - **交易安全性**: 實作「預扣 -> 成功扣除 / 失敗返還」的事務機制。交易失敗需在 5-10 分鐘內觸發自動補還 Job。

### C. 會員權益自動發放 (Benefit Distribution)

- **每月發放 Job**: 每月 1 日 00:00 執行。
  - 根據當前等級分發：道具卡、優惠券、免運券。
  - 使用郵件或站內信通知會員。

### D. 售後處理

- **紅利回收**: 退貨/退款流程中需包含「逆向扣除紅利點」邏輯，防止帳戶餘額為負（若點數已使用，則從退款金額中折抵扣除）。

## 6. SlimeToy 風格佈局與排版指導 (視覺追加優化)

本章節旨在指導如何參照 [Slime Toy 史萊姆玩具](https://slimetoy.com.tw/) 的 UI/UX 風格，優化本專案的 RWD 質感。

### A. 行動端「App 化」導覽佈局

- **底部固定導覽 (Bottom Sticky Nav)**: 針對手機端玩家，必須具備底部快捷欄。
  - **分頁圖示**: 【首頁】、【扭蛋】、【一番賞】、【動漫周邊】、【會員中心】。
  - **設計**: 具備微陰影或磨砂玻璃 (Glassmorphism) 效果，確保文字與圖示清晰。
- **頂部極簡導覽**: 只保留 Logo、代幣/積分顯示及通知圖示。

### B. 商品展示佈局 (Grid & Card)

- **首頁商品流**: 採用 **2 欄位網格 (Grid 2xN)** 或 **大面積卡片流** 排版。
- **卡片細節**:
  - 圖片佔比 70% 以上，圓角設計 (Border-radius)。
  - 狀態標籤 (Status Badge): 在圖片左上/右上標註「HOT」、「NEW」、「SOLD OUT」。
  - 快速購買按鈕置於卡片右下角。

### C. 抽獎詳情頁視覺階層

- **橫向滑動獎項預覽 (Horizontal Scroll)**: 參考 SlimeToy 詳情頁，將獎項（A 賞、B 賞等）以橫向卡片形式排列，方便手機端單手左右滑動查看細節。
- **資訊優先級**: IP 商品主圖 -> 獎項分布列表 -> 視覺化籤紙/扭蛋機區域。
- **浮動操作區**: 底部固定放置【試抽】與【正式抽】按鈕，按鈕需具備顯眼且具層次感的色彩。

### D. 配色與細節美學

- **磨砂玻璃介面 (Glassmorphism)**: 在彈出視窗（如登錄、中獎結果）與底部 Bar 使用半透明模糊背景。
- **品牌一致性**: 雖然風格參考 SlimeToy，但整體配色需根據「一抽入魂」的 **黑、紅、金** 主色調進行調整，保持精品、專業的氛圍。

## 5. 行動端沉浸式體驗與全系統試抽功能 (補充需求)

### A. 全系統試抽機制 (Trial Feature)

- **核心要求**: 針對「一番賞 (C)」、「動漫周邊 (D)」、「扭蛋系統 (E)」全面導入試抽功能。
- **目的**: 讓玩家在進入正式消費前，能先行體驗一套完整且精美的抽獎動畫（選號 -> 過程 -> 揭曉），降低進入門檻。

### B. 沉浸式登錄轉換 (Seamless Conversion)

- **轉換邏輯**: 當玩家在試抽後想要正式購買（真抽），或直接進行正式抽選時，若系統檢測到未登錄，**嚴禁跳轉至獨立登錄頁**。
- **技術實現**:
  - 直接在當前頁面彈出 **登錄 / 註冊一體化 Modal 彈窗**。
  - 登錄完成後，彈窗無感關閉並直接開啟支付確認，確保玩家的視覺與情緒不被頁面跳轉打斷。

### C. 手機優先 RWD 設計 (Mobile-First UX)

- **流量比例**: 預計 9 成用戶使用行動裝置消費。
- **設計準則**:
  - **觸控優化**: 所有高互動元素（如扭蛋旋轉把手、一番賞撕票區）需具備「大點擊熱區」與「觸覺反饋感（動畫/震動）」。
  - **屏幕適配**: 確保橫幅標題、活動主圖與抽獎組件在不同尺寸手機（16:9, 19.5:9 等）下完美適配，無破版現象。
  - **沉浸感提升**: 抽獎過程中使用全屏或近全屏的層疊效果，遮蔽無關干擾資訊。

## 14. 核心抽獎演算法與商業收益管控制 (Gacha Algorithm & Revenue Control)

### A. 收益保護鎖定機制 (Revenue Protection Lock)

為確保平台營運的獲利穩定性及防止熱門機台大獎過早被抽空（導致剩餘籤紙無人問津），系統導入階段性獎勵解鎖機制：

- **70% 抽獎門檻原則**:
  - 當單一機台/箱體（如轉盤、一番賞、九宮格）的總抽取進度（已抽數量 / 總數量）**未達 70%** 時，大獎 (Jackpot/A獎) 處於**鎖定狀態**。
  - 在此階段，系統概率引擎會自動過濾大獎結果，確保大獎僅在池子消耗至一定程度後才具備開出的可能性。
  - **解鎖條件**: 一旦消費進度突破 **70%**，系統將自動從「收益保護模式」切換為「公平競爭模式」，完整開放所有大獎權重。

### B. 會員幸運值與保底機制 (Lucky Value & Guarantee)

為提升玩家留存並降低連續未中獎的挫折感，系統提供自動保底補償：

- **幸運值累積**:
  - 每當玩家進行一次未獲得大獎的有效抽獎，帳號將獲得 **10 點幸運值**。
  - 幸運值可於機台視窗實時查看進度百分比（當前值 / 門檻值）。
- **保底觸發規則**:
  - 當幸運值累積至 100%（例如設定門檻為 100 點）時，下一次抽獎將**無視 70% 收益保護規則**與隨機機率，**強制揭曉池內剩餘的大獎項目**。
- **重置邏輯**:
  - 只要玩家獲得任一標記為「大獎 (Jackpot)」或「一番賞 A 賞」的獎項，該機台累積的幸運值即刻**歸零**。

---

## 15. 後台管理系統與權限管控規格 (Backend RBAC System)

為確保管理後台的安全與權責分立，系統必須導入完整的「基於角色之存取控制 (RBAC)」機制。

### A. 權限核心架構

- **角色 (Role)**: 系統應支持多個角色定義（如：超級管理員、客服專員、財務審核員、庫存管理員）。
- **權限樹 (Permission Tree)**: 每個角色通過勾選權限樹節點來定義其職能範圍。
- **綁定機制**: 後台用戶帳號必須綁定一個或多個角色，其權限為所屬角色之聯集。

### B. 權限粒度與控制層級

權限控制必須深入至以下三個維度：

1. **選單級別 (Menu Level)**: 控制左側導覽列選單的顯示與隱藏（如：財務人員看不到「機台設定」選單）。
2. **標籤級別 (Tab Level)**: 在頁面內部的分頁切換（Tabs）中進行過濾。
3. **按鈕級別 (Button Level)**:
    - 關鍵操作（如：【修改】、【刪除】、【手動開獎】、【退款執行】）必須根據權限樹決定是否渲染。
    - 前端隱藏按鈕後，後端 API 亦須實施對應的權限檢查（攔截器/切面）。

### C. 特殊角色：Administrator

- **定義**: 系統內建名為 `administrator` 的最高權限角色。
- **權利內容**:
  - 自動具備權限樹中所有的勾選項目。
  - 擁有管理其他角色與權限分配的權利。
  - 在全站 UI 中不受任何選單、標籤或按鈕隱藏邏輯限制。

### D. 權限維護介面需求

- **角色管理**: 提供 CRUD 介面，並以樹狀組件（Tree View）展示權限節點。
- **權限節點定義**:
  - `MODULE` (模組) -> `MENU` (選單) -> `PAGE` (頁面) -> `ACTION` (按鈕/功能)。
- **同步機制**: 修改角色權限後，已登錄的相關用戶應在下次請求或重新登錄時即刻生效。

---

## 16. 後台數據儀表板與營運分析規格 (Backend Dashboard & Analytics)

為協助營運團隊即時掌握平台健康狀況，管理後台首頁應整合視覺化儀表板，提供核心商業數據分析。

### A. 關鍵數據指標 (KPI Cards)

- **待處理事項**:
  - **待出貨數量 (Pending Shipments)**: 當前「盒櫃」中已申請發貨但尚未填寫物流單號的總件數。
  - **庫存預警**: 剩餘籤數低於 10% 的一番賞箱體數量。
- **即時營運指標**:
  - **今日總營收**: 當日儲值代幣總額。
  - **今日抽獎總次數**: 全站所有機台當日被啟動次數。
  - **目前全站回獎率 (RTP - Return to Player)**:
    - 計算公式：`已產出獎項總價值 (估值) / 總消耗代幣價值`。
    - 監控目的：確保符合 70% 收益保護規則之下的長期利潤平衡。

### B. 排行榜與熱度分析 (Top 10 Rankings)

系統應具備大數據統計模組，呈現以下 TOP 10 指標：

1. **儲值貢獻榜 (Top 10 Deposits)**: 累計儲值代幣最高的前 10 名會員（用於 VIP 客戶維護）。
2. **熱門機台排行榜 (Top 10 Popularity)**: 根據抽取次數、營收金額排列的一番賞、盲盒、扭蛋機台。
3. **會員活躍榜 (Top 10 Active Members)**:
    - **指標 A**: 最近 30 天登入天數最多。
    - **指標 B**: 累計消費額度（代幣消耗量）最高。
4. **積分兌換榜**: 積分商店中最受歡迎的實體商品（用於庫存採購參考）。

### C. 補充營運維度 (Additional Analytics)

為了提供更全面的決策支持，建議補充以下維度：

- **營收組成分析**: 以圓餅圖顯示「一番賞、轉盤、九宮格、扭蛋、直接購買」各自的營收佔比。
- **留存率分析**: 新會員註冊後 7 日與 30 日的持續抽獎比例。
- **異常行為監控**:
  - 同一 IP 多帳號操作預警。
  - 短時間內超出常理的高頻儲值/消費行為（防刷、防洗錢）。
- **物流時效監控**: 從玩家申請發貨到實際物流收寄的平均耗時（KPI 指標）。

---

## 17. 專業級營運功能擴展預留 (Professional Operations Extension)

身為資深系統分析師，經過對現行規範的審查，目前的 1-16 章節已覆蓋了 80% 的核心業務（抽獎邏輯、基本管理、數據看板）。然而，要應對一個 **20,000+ 會員**且具備實體門市背景的「專業級平台」，仍需補足以下「營運效率」與「風險審計」維度的功能：

### A. 自動化排程與內容營運 (Automated Scheduling)

- **機台定時上/下架**: 支持設定一番賞或扭蛋機台的生效時間（如：週五午夜自動上架元旦限定款）。
- **完售自動更替**: 當 A 箱一番賞完售後，系統自動依序遞補 B 箱，確保首頁「熱門」區域永遠不空窗。
- **全站公告排程**: 支持預約發佈維護公告或活動通知。

### B. 安全審計與風控追蹤 (Audit Trail & Risk Control)

針對 2 萬人規模的平台，內部人員的錯誤操作或外部惡意套利是最大風險：

- **操作審計日誌 (Admin Audit Logs)**: 詳細記錄管理員「何時」修改了「哪筆訂單」、調整了「誰的餘額」或變動了「哪台機器的機率」。
- **異常波動警報**:
  - 若某帳號在 1 分鐘內餘額變動超過指定門檻，系統自動鎖定並通知風控。
  - 若某一機台的回獎率 (RTP) 低於或高於預設安全區間（如 60%~95%），觸發紅色預警。

### C. 會員關係管理深度化 (Advanced CRM)

- **會員標籤系統 (Tagging)**: 根據消費習慣自動貼標（如：動漫重度玩家、首充未續費玩家、一番賞獵人）。
- **手動資產補發**: 處理爭議或補償時，管理員可手動補發「道具卡」或「特定實體獎項」至玩家盒櫃。
- **內部備註與聯絡紀錄**: 紀錄與 VIP 會員的溝通歷程，方便不同客服交接。

### D. 流通與行銷推廣工具 (Growth Toolkit)

- **邀請人/推薦制度 (Referral System)**: 建立推薦碼機制，獎勵引薦新會員的老玩家。
- **禮包碼/兌換碼 (Gift Codes)**: 用於線下活動或社群宣傳，玩家輸入序號即可兌換特定代幣或道具卡。
- **動態 Banner 管理**: 支持無代碼更換首頁幻燈片、彈窗廣告與側邊懸浮按鈕 Link。

### E. 倉儲物流進階整合 (Warehouse Lite)

- **合單規則配置**: 靈活設定「滿 X 件免運」或「大件物品加收運費」的細化規則。
- **物流單號批次匯入**: 支持從 Excel 定量匯入物流追蹤號，同步發送出貨簡訊/App 推送。
- **實體庫存同步機制**: 當線上抽中實體獎項時，自動扣除後台「虛實整合倉庫」的 SKU 數量。

---

## 18. 多元金流串接與帳務安全規範 (External Payment Integration & Financial Security)

對於一個 2 萬人規模的專業平台，**自動化金流串接**是運營效率的核心。目前系統必須將原有的後台手動充值提升為第三方支付網關自動自動對帳機制。

### A. 支援支付渠道與技術選型

系統應預留接口，對接台灣主流第三方金流平台（如：**藍新 NewebPay**、**綠界 ECPay** 或 **Line Pay**）：

1. **信用卡 (Credit Card)**: 支援一次付清、定期定額（適用於 VIP 訂閱）。
2. **超商代碼/條碼 (CVS Order)**: 滿足學生族群或無卡族群之支付需求。
3. **虛擬帳號 (ATM / WebATM)**: 適合大額儲值，具備獨立虛擬帳號以便自動對帳。

### B. 金流交易流程與安全性 (Payment Workflow)

為防止「偽造交易」與「重複入帳」，必須實施以下安全規範：

- **SHA256 簽名驗證 (Hash Integrity)**:
  - 請求發送與 Webhook 回傳（Notify URL）必須強制校驗 Hash 值，確保交易參數未被中途串改。
- **無縫 Webhook 處理機制 (Asynchronous Notification)**:
  - 後端需建立 `PaymentCallbackController` 處理異步通知。
  - 入帳邏輯必須包裹在資料庫 **事務 (Transaction)** 內，先更新交易單狀態，再注入代幣。
- **冪等性設計 (Idempotency)**:
  - 確保同一筆金流序號在多次收到回傳通知時，僅會執行一次餘額變動，嚴防重複加款。

### C. 後台帳務管理功能 (Financial Management)

- **自動對帳報表 (Reconciliation Report)**:
  - 提供「系統交易紀錄」與「第三方金流後台」之對比報表，標註掉帳或狀態不一的訂單。
- **退款工作流 (Refund Workflow)**:
  - 支持「線上退款」接口調用（信用卡原路返回）。
  - 嚴格控制退款權限，每筆退款操作必須寫入 **Audit Log** 並與原儲值單關聯。
- **發票自動化 (E-Invoice)**:
  - 儲值成功後，自動調用電子發票 API 開立發票（二聯/三聯/載具），並發送發票開立通知。

### D. 風控與預警 (Risk & Anti-Fraud)

- **3D 驗證強制化**: 針對高風險或大額信用交易，強制觸發 3D 驗證以規避盜刷風險。
- **異常儲值行為阻斷**:
  - 若單一卡號 1 小時內嘗試儲值失敗超過 3 次，暫時封鎖該卡號支付。
  - 監控「快速儲值後立即進行高頻抽獎」之行為，防止利用金流平台漏洞套利。

---

## 19. 後台管理系統架構清單 (Backend Menu & UI Components Map)

本章節詳列後台管理系統的選單結構 (Menu)、頁面分頁 (Tabs) 及核心按鈕 (Buttons)，作為後續開發與權限樹配置之依據。

### 1. 數據控制台 (Dashboard)

- **選單名稱**: `控制台`
- **主要元件**:
  - 數據概況卡片 (KPI Cards)
  - 營收趨勢圖 (Line Chart)
  - 本週熱門排行榜 (Bar Chart)
- **按鈕**: 【今日報表下載】、【切換時間維度】

### 2. 會員與權限管理 (User & RBAC)

- **選單名稱**: `會員管理`
  - **Tab 1: 會員清單**: 【搜索】、【編輯資產】、【黑名單/封號】、【查看抽獎紀錄】
  - **Tab 2: VIP 等級設定**: 【新增等級】、【修改門檻】、【配置等級福利】
  - **Tab 3: 成長值日誌**: 查閱會員升降級歷史
- **選單名稱**: `權限設定`
  - **Tab 1: 管理員帳號**: 【新增帳號】、【重設密碼】、【分配角色】
  - **Tab 2: 角色與權限樹**: 【新增角色】、【權限樹勾選配置】、【刪除角色】

### 3. 機台與商品管理 (Games & Items)

- **選單名稱**: `IP 主題管理`: 【新增 IP】、【批量上下架】、【編輯圖文描述】
- **選單名稱**: `一番賞管理`
  - **Tab 1: 箱體列表**: 【新增箱體】、【複製作業】、【完售封存】
  - **Tab 2: 獎項配置**: 【新增獎項/級別】、【配置數量】、【圖片上傳】
  - **Tab 3: 籤紙網格檢視**: 【預覽抽獎池】
- **選單名稱**: `盲盒/扭蛋管理`
  - **Tab 1: 在售列表**: 【新增機台】、【修改單抽價格】
  - **Tab 2: 庫存管理**: 【補貨】、【設置保底門檻】
- **選單名稱**: `活動機台 (轉盤/九宮格)`: 【修改中獎率】、【配置 70% 收益保護】

### 4. 訂單與物流中心 (Orders & Logistics)

- **選單名稱**: `抽獎紀錄查詢`: 全站所有抽獎行為的數據流
- **選單名稱**: `盒櫃監控`: 查看玩家目前尚未提領的商品清單
- **選單名稱**: `發貨申請管理`
  - **Tab 1: 待出貨**: 【揀貨單列印】、【填寫物流單號】、【批量導出 Excel】
  - **Tab 2: 運送中**: 【追蹤物流狀態】、【修改地址(限期內)】
  - **Tab 3: 已完成**: 歷史訂單存檔
  - **Tab 4: 異常/退貨**: 【執行退款流程】、【作廢訂單】

### 5. 行銷與內容營運 (Marketing & CMS)

- **選單名稱**: `積分兌換管理`: 配置積分商店商品、庫存與兌換點數
- **選單名稱**: `任務中心配置`: 設定每日簽到獎勵、任務階段目標
- **選單名稱**: `兌換碼管理`: 【生成批次序號】、【查看使用紀錄】
- **選單名稱**: `廣告與 Banner`: 【上傳幻燈片】、【彈窗公告設定】、【自定義選單位置】

### 6. 金流與財務審計 (Finance & Audit)

- **選單名稱**: `儲值紀錄查詢`: 所有支付網關的回傳紀錄與狀態
- **選單名稱**: `財務報表`: 【月結對帳單】、【回獎率 (RTP) 分析表】
- **選單名稱**: `發票管理`: 【補開發票】、【作廢發票紀錄】
- **選單名稱**: `系統操作日誌`: 全站管理員的行動審計紀錄

---
