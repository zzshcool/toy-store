<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{admin_layout :: html(title='IP 主題管理', content=~{::content})}">

<body>
    <div th:fragment="content">
        <div th:if="${success}" class="alert alert-success" th:text="${success}"
            style="margin-bottom: 20px; padding: 15px; background: #d4edda; color: #155724; border-radius: 8px;"></div>
        <div th:if="${error}" class="alert alert-danger" th:text="${error}"
            style="margin-bottom: 20px; padding: 15px; background: #f8d7da; color: #721c24; border-radius: 8px;"></div>

        <!-- 新增 IP 表單 -->
        <div class="form-card">
            <h3 style="margin-bottom: 20px;">➕ 新增 IP 主題</h3>
            <form th:action="@{/admin/gacha/ips/create}" method="post">
                <div class="form-grid">
                    <div class="form-group">
                        <label>IP 名稱</label>
                        <input type="text" name="name" required placeholder="例：洛克人、航海王">
                    </div>
                    <div class="form-group">
                        <label>圖片網址</label>
                        <input type="text" name="imageUrl" placeholder="https://...">
                    </div>
                </div>
                <div class="form-group">
                    <label>描述</label>
                    <textarea name="description" rows="2" placeholder="IP 主題描述..."></textarea>
                </div>
                <button type="submit" class="btn btn-primary">建立 IP</button>
            </form>
        </div>

        <!-- IP 列表 -->
        <table class="data-table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>名稱</th>
                    <th>描述</th>
                    <th>狀態</th>
                    <th>建立時間</th>
                    <th>操作</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="ip : ${ips}">
                    <td th:text="${ip.id}"></td>
                    <td th:text="${ip.name}"></td>
                    <td th:text="${ip.description}"></td>
                    <td>
                        <span class="status-badge"
                            th:classappend="${ip.status.name() == 'ACTIVE' ? 'status-active' : (ip.status.name() == 'INACTIVE' ? 'status-inactive' : 'status-coming')}"
                            th:text="${ip.status.name()}"></span>
                    </td>
                    <td th:text="${#temporals.format(ip.createdAt, 'yyyy-MM-dd HH:mm')}"></td>
                    <td>
                        <button onclick="editIp(this)" class="btn btn-sm btn-outline" th:data-id="${ip.id}"
                            th:data-name="${ip.name}" th:data-desc="${ip.description}" th:data-img="${ip.imageUrl}"
                            th:data-status="${ip.status}">編輯</button>
                    </td>
                </tr>
                <tr th:if="${#lists.isEmpty(ips)}">
                    <td colspan="6" class="text-center" style="padding: 30px;">尚無 IP 主題，請新增</td>
                </tr>
            </tbody>
        </table>
        <!-- 編輯彈窗 -->
        <div id="editModal"
            style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
            <div style="background: white; padding: 30px; border-radius: 15px; max-width: 500px; width: 90%;">
                <h3 style="margin-bottom: 20px;">編輯 IP 主題</h3>
                <form th:action="@{/admin/gacha/ips/__id__/update}" method="post" id="editForm">
                    <input type="hidden" name="id" id="editId">
                    <div class="form-group">
                        <label>名稱</label>
                        <input type="text" name="name" id="editName" required>
                    </div>
                    <div class="form-group">
                        <label>描述</label>
                        <textarea name="description" id="editDesc" rows="2"></textarea>
                    </div>
                    <div class="form-group">
                        <label>圖片網址</label>
                        <input type="text" name="imageUrl" id="editImg">
                    </div>
                    <div class="form-group">
                        <label>狀態</label>
                        <select name="status" id="editStatus">
                            <option value="ACTIVE">啟用中</option>
                            <option value="INACTIVE">停用</option>
                            <option value="COMING_SOON">即將推出</option>
                        </select>
                    </div>
                    <div style="display: flex; gap: 15px; margin-top: 20px;">
                        <button type="button" onclick="closeEditModal()" class="btn btn-outline">取消</button>
                        <button type="submit" class="btn btn-primary">儲存</button>
                    </div>
                </form>
            </div>
        </div>

        <script>
            function editIp(btn) {
                const id = btn.dataset.id;
                document.getElementById('editId').value = id;
                document.getElementById('editName').value = btn.dataset.name;
                document.getElementById('editDesc').value = btn.dataset.desc || '';
                document.getElementById('editImg').value = btn.dataset.img || '';
                document.getElementById('editStatus').value = btn.dataset.status;
                document.getElementById('editForm').action = `/admin/gacha/ips/${id}/update`;
                document.getElementById('editModal').style.display = 'flex';
            }
            function closeEditModal() {
                document.getElementById('editModal').style.display = 'none';
            }
        </script>
    </div>
</body>

</html>