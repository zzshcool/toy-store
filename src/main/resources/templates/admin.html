<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{admin_layout :: html(title='ÁÆ°ÁêÜÂæåÂè∞', content=~{::content})}">

<body>
    <div th:fragment="content">
        <!-- Tabs -->
        <div th:if="${errorMessage}" class="alert alert-danger"
            style="color: red; padding: 10px; border: 1px solid red; margin-bottom: 10px;">
            <b th:text="${errorMessage}">Error</b>
        </div>
        <div
            style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 10px;">
            <button onclick="openTab('members')" class="btn btn-outline btn-sm">ÊúÉÂì°ÁÆ°ÁêÜ</button>
            <button onclick="openTab('levels')" class="btn btn-outline btn-sm">Á≠âÁ¥öÁÆ°ÁêÜ</button>
            <button onclick="openTab('products')" class="btn btn-outline btn-sm">ÂïÜÂìÅÁÆ°ÁêÜ</button>
            <button onclick="openTab('categories')" class="btn btn-outline btn-sm">ÂàÜÈ°ûÁÆ°ÁêÜ</button>
            <button onclick="openTab('mystery')" class="btn btn-outline btn-sm">Áõ≤ÁõíÁÆ°ÁêÜ</button>
            <button onclick="openTab('transactions')" class="btn btn-outline btn-sm">‰∫§ÊòìÁÆ°ÁêÜ</button>
            <button onclick="openTab('activities')" class="btn btn-outline btn-sm">Ê¥ªÂãïÁÆ°ÁêÜ</button>
            <button onclick="openTab('coupons')" class="btn btn-outline btn-sm">ÂÑ™ÊÉ†Âà∏ÁÆ°ÁêÜ</button>
            <button onclick="openTab('platform')" class="btn btn-outline btn-sm">Âπ≥Âè∞ÁÆ°ÁêÜ</button>
            <button onclick="openTab('logs')" class="btn btn-outline btn-sm">Êìç‰ΩúÊó•Ë™å</button>
        </div>

        <!-- Member Management -->
        <div id="members" class="tab-content">
            <h3>ÊúÉÂì°ÂàóË°®</h3>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>‰ΩøÁî®ËÄÖÂêçÁ®±</th>
                        <th>È§òÈ°ç</th>
                        <th>Á≠âÁ¥ö</th>
                        <th>ÊúÄÂæåÁôªÂÖ•</th>
                        <th>Ë®ªÂÜäÊó•Êúü</th>
                        <th>ÁãÄÊÖã</th>
                        <th>Êìç‰Ωú</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="member : ${members}">
                        <td th:text="${member.id}">1</td>
                        <td th:text="${member.username}">User</td>
                        <td th:text="${member.platformWalletBalance}">1000</td>
                        <td th:text="${member.level != null ? member.level.name : 'Âπ≥Ê∞ë'}">Level</td>
                        <td
                            th:text="${member.lastLoginTime != null ? #temporals.format(member.lastLoginTime, 'yyyy-MM-dd HH:mm') : 'Êú™ÁôªÂÖ•'}">
                            2023-01-01</td>
                        <td
                            th:text="${member.createdAt != null ? #temporals.format(member.createdAt, 'yyyy-MM-dd HH:mm') : '-'}">
                            2023-01-01</td>
                        <td>
                            <span th:class="${member.enabled ? 'badge badge-success' : 'badge badge-danger'}"
                                th:text="${member.enabled ? 'Ê≠£Â∏∏' : 'Â∑≤Â∞ÅÈéñ'}">Ê≠£Â∏∏</span>
                        </td>
                        <td style="display: flex; gap: 5px;">
                            <form th:action="@{/admin/members/{id}/toggle-status(id=${member.id})}" method="post"
                                style="margin:0;">
                                <button type="submit" class="btn btn-sm"
                                    th:classappend="${member.enabled ? 'btn-danger' : 'btn-success'}"
                                    th:text="${member.enabled ? 'Â∞ÅÈéñ' : 'ÂïüÁî®'}">Â∞ÅÈéñ</button>
                            </form>
                            <button class="btn btn-sm btn-info"
                                th:onclick="'showHistory(' + ${member.id} + ')'">Ê≠∑Âè≤Á¥ÄÈåÑ</button>
                            <button class="btn btn-sm btn-primary"
                                th:onclick="editMember([[${member.id}]], '[[${member.email}]]', '[[${member.nickname}]]', [[${member.enabled}]], [[${member.level != null ? member.level.id : ''}]])">Á∑®ËºØ</button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Product Management -->
        <div id="products" class="tab-content" style="display:none;">
            <h3>ÂïÜÂìÅÁÆ°ÁêÜ</h3>
            <div class="card" style="padding: 20px; margin-bottom: 20px;">
                <h4>Êñ∞Â¢ûÂïÜÂìÅ</h4>
                <form th:action="@{/admin/products}" method="post" th:object="${newProduct}">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <input type="text" name="name" placeholder="ÂêçÁ®±" class="form-control" required />
                        <input type="number" step="0.01" name="price" placeholder="ÂÉπÊ†º" class="form-control" required />
                        <input type="number" name="stock" placeholder="Â∫´Â≠ò" class="form-control" required />
                        <select id="prodCategory" name="category" class="form-control"
                            onchange="loadSubCats(this.value)" required>
                            <option value="">ÈÅ∏ÊìáÂ§ßÂàÜÈ°û</option>
                            <option th:each="cat : ${categories}" th:value="${cat.id}" th:text="${cat.name}"></option>
                        </select>
                        <select id="prodSubCategory" name="subCategory" class="form-control" required>
                            <option value="">ÈÅ∏ÊìáÂ≠êÂàÜÈ°û</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary" style="margin-top: 10px;">Êñ∞Â¢û</button>
                </form>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>ÂêçÁ®±</th>
                        <th>ÂàÜÈ°û</th>
                        <th>Â≠êÂàÜÈ°û</th>
                        <th>ÂÉπÊ†º</th>
                        <th>Â∫´Â≠ò</th>
                        <th>Êìç‰Ωú</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="product : ${products}">
                        <td th:text="${product.id}">1</td>
                        <td th:text="${product.name}">Toy</td>
                        <td th:text="${product.category != null ? product.category : '-'}">Cat</td>
                        <td th:text="${product.subCategory != null ? product.subCategory : '-'}">Sub</td>
                        <td th:text="${product.price}">100</td>
                        <td th:text="${product.stock}">10</td>
                        <td style="font-size: 1.2em;">
                            <a href="#" title="‰øÆÊîπÂêçÁ®±">‚úèÔ∏è</a>
                            <a href="#" title="Ë™øÊï¥ÂÉπÊ†º">üí≤</a>
                            <a href="#" title="Ë™øÊï¥Â∫´Â≠ò">üì¶</a>
                            <form th:action="@{/admin/products/delete/{id}(id=${product.id})}" method="post"
                                style="display:inline;" onsubmit="return confirm('Á¢∫ÂÆöÂà™Èô§Ôºü');">
                                <button type="submit" style="background:none;border:none;cursor:pointer;"
                                    title="Âà™Èô§">üóëÔ∏è</button>
                            </form>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Member Level Management -->
        <div id="levels" class="tab-content" style="display:none;">
            <h3>ÊúÉÂì°Á≠âÁ¥öÁÆ°ÁêÜ</h3>
            <div class="card" style="padding: 20px; margin-bottom: 20px;">
                <h4>Êñ∞Â¢ûÁ≠âÁ¥ö</h4>
                <form th:action="@{/admin/member-levels}" method="post">
                    <div style="display: grid; grid-template-columns: repeat(5, 1fr); gap: 10px;">
                        <input type="text" name="name" placeholder="Á≠âÁ¥öÂêçÁ®±" class="form-control" required />
                        <input type="number" name="sortOrder" placeholder="ÊéíÂ∫è (1=ÊúÄ‰Ωé)" class="form-control" required />
                        <input type="number" step="0.01" name="threshold" placeholder="Á¥ØÁ©çÂÑ≤ÂÄºÈñÄÊ™ª" class="form-control"
                            required />
                        <input type="text" name="monthlyReward" placeholder="ÊØèÊúàÁçéÂãµ" class="form-control" />
                        <button type="submit" class="btn btn-primary">Êñ∞Â¢û</button>
                    </div>
                </form>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>ÊéíÂ∫è</th>
                        <th>ÂêçÁ®±</th>
                        <th>ÈñÄÊ™ª</th>
                        <th>ÊØèÊúàÁçéÂãµ</th>
                        <th>ÁãÄÊÖã</th>
                        <th>Êìç‰Ωú</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="lvl : ${memberLevels}">
                        <td th:text="${lvl.sortOrder}">1</td>
                        <td th:text="${lvl.name}">Common</td>
                        <td th:text="${lvl.threshold}">0</td>
                        <td th:text="${lvl.monthlyReward}">-</td>
                        <td th:text="${lvl.enabled ? 'ÂïüÁî®' : 'ÂÅúÁî®'}">Active</td>
                        <td>
                            <button class="btn btn-sm btn-info"
                                th:onclick="editLevel([[${lvl.id}]], '[[${lvl.name}]]', [[${lvl.sortOrder}]], [[${lvl.threshold}]], '[[${lvl.monthlyReward}]]', [[${lvl.enabled}]])">‚úèÔ∏è</button>
                            <form th:action="@{/admin/member-levels/delete/{id}(id=${lvl.id})}" method="post"
                                style="display:inline;" onsubmit="return confirm('Á¢∫ÂÆöÂà™Èô§Á≠âÁ¥öÔºü');">
                                <button type="submit" style="background:none;border:none;cursor:pointer;"
                                    title="Âà™Èô§">üóëÔ∏è</button>
                            </form>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Category Management -->
        <div id="categories" class="tab-content" style="display:none;">
            <h3>ÂàÜÈ°ûÁÆ°ÁêÜ</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div class="card">
                    <h4>ÂàÜÈ°ûÂàóË°®</h4>
                    <ul style="list-style-type: none; padding-left: 0;">
                        <li th:each="cat : ${categories}"
                            style="margin-bottom: 10px; border: 1px solid #ddd; padding: 10px; border-radius: 5px;">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; background: #f0f0f0; padding: 5px;">
                                <strong th:text="${cat.name}">Category</strong>
                                <div>
                                    <button class="btn btn-sm btn-info"
                                        th:onclick="editCategory([[${cat.id}]], '[[${cat.name}]]')">‚úèÔ∏è</button>
                                    <form th:action="@{/admin/categories/delete/{id}(id=${cat.id})}" method="post"
                                        style="display:inline;" onsubmit="return confirm('Âà™Èô§‰∏ªÂàÜÈ°ûÂ∞áÈÄ£ÂêåÂ≠êÂàÜÈ°û‰∏ÄËµ∑Âà™Èô§ÔºåÁ¢∫ÂÆöÔºü');">
                                        <button type="submit" style="background:none;border:none;cursor:pointer;"
                                            title="Âà™Èô§">üóëÔ∏è</button>
                                    </form>
                                </div>
                            </div>
                            <ul style="margin-top: 5px; padding-left: 20px;">
                                <li th:each="sub : ${cat.subCategories}"
                                    style="display: flex; justify-content: space-between; border-bottom: 1px solid #eee;">
                                    <span th:text="${sub.name}">Sub</span>
                                    <div>
                                        <button class="btn btn-sm" style="font-size:0.8em;"
                                            th:onclick="editSubCategory([[${sub.id}]], '[[${sub.name}]]')">‚úèÔ∏è</button>
                                        <form th:action="@{/admin/subcategories/delete/{id}(id=${sub.id})}"
                                            method="post" style="display:inline;"
                                            onsubmit="return confirm('Á¢∫ÂÆöÂà™Èô§Â≠êÂàÜÈ°ûÔºü');">
                                            <button type="submit"
                                                style="font-size:0.8em;background:none;border:none;cursor:pointer;"
                                                title="Âà™Èô§">üóëÔ∏è</button>
                                        </form>
                                    </div>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
                <div class="card">
                    <h4>Êñ∞Â¢ûÂàÜÈ°û</h4>
                    <form th:action="@{/admin/categories}" method="post" style="margin-bottom: 20px;">
                        <div style="display: flex; gap: 5px;">
                            <input type="text" name="name" placeholder="Â§ßÂàÜÈ°ûÂêçÁ®±" class="form-control" required>
                            <button type="submit" class="btn btn-primary">Êñ∞Â¢ûÂ§ßÂàÜÈ°û</button>
                        </div>
                    </form>

                    <h4>Êñ∞Â¢ûÂ≠êÂàÜÈ°û</h4>
                    <form th:action="@{/admin/subcategories}" method="post">
                        <div style="display: flex; gap: 5px;">
                            <select name="categoryId" class="form-control" required>
                                <option value="">ÈÅ∏ÊìáÊâÄÂ±¨Â§ßÂàÜÈ°û</option>
                                <option th:each="cat : ${categories}" th:value="${cat.id}" th:text="${cat.name}">
                                </option>
                            </select>
                            <input type="text" name="name" placeholder="Â≠êÂàÜÈ°ûÂêçÁ®±" class="form-control" required>
                            <button type="submit" class="btn btn-primary">Êñ∞Â¢û</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Category Edit Modal -->
            <div id="editCategoryModal" class="modal"
                style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5);">
                <div class="card" style="margin: 15% auto; width: 30%; padding: 20px;">
                    <h4>Á∑®ËºØÂàÜÈ°û</h4>
                    <form th:action="@{/admin/categories/update}" method="post">
                        <input type="hidden" id="editCatId" name="id">
                        <input type="text" id="editCatName" name="name" class="form-control" required>
                        <div style="margin-top: 10px; display: flex; justify-content: flex-end; gap: 10px;">
                            <button type="button" class="btn btn-secondary"
                                onclick="document.getElementById('editCategoryModal').style.display='none'">ÂèñÊ∂à</button>
                            <button type="submit" class="btn btn-primary">ÂÑ≤Â≠ò</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- SubCategory Edit Modal -->
            <div id="editSubCategoryModal" class="modal"
                style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5);">
                <div class="card" style="margin: 15% auto; width: 30%; padding: 20px;">
                    <h4>Á∑®ËºØÂ≠êÂàÜÈ°û</h4>
                    <form th:action="@{/admin/subcategories/update}" method="post">
                        <input type="hidden" id="editSubCatId" name="id">
                        <input type="text" id="editSubCatName" name="name" class="form-control" required>
                        <div style="margin-top: 10px; display: flex; justify-content: flex-end; gap: 10px;">
                            <button type="button" class="btn btn-secondary"
                                onclick="document.getElementById('editSubCategoryModal').style.display='none'">ÂèñÊ∂à</button>
                            <button type="submit" class="btn btn-primary">ÂÑ≤Â≠ò</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Mystery Box Management -->
        <div id="mystery" class="tab-content" style="display:none;">
            <h3>Áõ≤ÁõíÁÆ°ÁêÜ</h3>
            <div class="card" style="padding: 20px; margin-bottom: 20px;">
                <h4>Êñ∞Â¢û‰∏ªÈ°å</h4>
                <!-- Theme Form -->
                <form th:action="@{/admin/mystery-box/themes}" method="post">
                    <div style="display: flex; gap: 10px;">
                        <input type="text" name="name" placeholder="‰∏ªÈ°åÂêçÁ®±" class="form-control" required />
                        <input type="number" step="0.01" name="price" placeholder="ÂÉπÊ†º" class="form-control" required />
                        <button type="submit" class="btn btn-primary">Êñ∞Â¢û‰∏ªÈ°å</button>
                    </div>
                </form>
            </div>

            <div th:each="theme : ${mysteryBoxThemes}" class="card" style="margin-bottom: 20px;">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <h4 th:text="${theme.name} + ' ($' + ${theme.price} + ')'">Gundam ($100)</h4>
                    <button class="btn btn-sm btn-info"
                        th:onclick="editTheme([[${theme.id}]], '[[${theme.name}]]', [[${theme.price}]])">Á∑®ËºØ‰∏ªÈ°å</button>

                    <form th:action="@{/admin/mystery-box/themes/delete/{id}(id=${theme.id})}" method="post"
                        style="display:inline;" onsubmit="return confirm('Âà™Èô§‰∏ªÈ°åÂ∞áÈÄ£ÂêåÁçéÂìÅ‰∏ÄËµ∑Âà™Èô§ÔºåÁ¢∫ÂÆöÔºü');">
                        <button type="submit" class="btn btn-sm btn-danger">Âà™Èô§‰∏ªÈ°å</button>
                    </form>
                </div>

                <!-- Add Item to Theme -->
                <form th:action="@{/admin/mystery-box/items}" method="post"
                    style="margin-bottom: 10px; background: #f9f9f9; padding: 10px;">
                    <input type="hidden" name="themeId" th:value="${theme.id}">
                    <div style="display: flex; gap: 5px;">
                        <input type="text" name="name" placeholder="ÁçéÂìÅÂêçÁ®±" class="form-control" required>
                        <input type="number" name="estimatedValue" placeholder="ÂÉπÂÄº" class="form-control" required>
                        <input type="number" name="weight" placeholder="Ê¨äÈáç(%)" class="form-control" required>
                        <button type="submit" class="btn btn-sm btn-secondary">Êñ∞Â¢ûÁçéÂìÅ</button>
                    </div>
                </form>

                <table>
                    <thead>
                        <tr>
                            <th>ÁçéÂìÅÂêçÁ®±</th>
                            <th>ÂÉπÂÄº</th>
                            <th>Ê¨äÈáç</th>
                            <th>Êìç‰Ωú</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr th:each="item : ${theme.items}">
                            <td th:text="${item.name}">Item</td>
                            <td th:text="${item.estimatedValue}">50</td>
                            <td th:text="${item.weight}">20</td>
                            <td>
                                <button class="btn btn-sm btn-info"
                                    th:onclick="editBoxItem([[${item.id}]], '[[${item.name}]]', [[${item.estimatedValue}]], [[${item.weight}]])">‚úèÔ∏è</button>
                                <form th:action="@{/admin/mystery-box/items/delete/{id}(id=${item.id})}" method="post"
                                    style="display:inline;" onsubmit="return confirm('Á¢∫ÂÆöÂà™Èô§ÁçéÂìÅÔºü');">
                                    <button type="submit" style="background:none;border:none;cursor:pointer;"
                                        title="Âà™Èô§">üóëÔ∏è</button>
                                </form>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <!-- Edit Theme Modal -->
            <div id="editThemeModal" class="modal"
                style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5);">
                <div class="card" style="margin: 15% auto; width: 30%; padding: 20px;">
                    <h4>Á∑®ËºØ‰∏ªÈ°å</h4>
                    <form th:action="@{/admin/mystery-box/themes/update}" method="post">
                        <input type="hidden" id="editThemeId" name="id">
                        <input type="text" id="editThemeName" name="name" class="form-control" placeholder="ÂêçÁ®±"
                            required>
                        <input type="number" step="0.01" id="editThemePrice" name="price" class="form-control"
                            placeholder="ÂÉπÊ†º" required>
                        <div style="margin-top: 10px; display: flex; justify-content: flex-end; gap: 10px;">
                            <button type="button" class="btn btn-secondary"
                                onclick="document.getElementById('editThemeModal').style.display='none'">ÂèñÊ∂à</button>
                            <button type="submit" class="btn btn-primary">ÂÑ≤Â≠ò</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Edit Box Item Modal -->
            <div id="editBoxItemModal" class="modal"
                style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5);">
                <div class="card" style="margin: 15% auto; width: 30%; padding: 20px;">
                    <h4>Á∑®ËºØÁçéÂìÅ</h4>
                    <form th:action="@{/admin/mystery-box/items/update}" method="post">
                        <input type="hidden" id="editBoxItemId" name="id">
                        <input type="text" id="editBoxItemName" name="name" class="form-control" placeholder="ÂêçÁ®±"
                            required>
                        <input type="number" id="editBoxItemValue" name="estimatedValue" class="form-control"
                            placeholder="ÂÉπÂÄº" required>
                        <input type="number" id="editBoxItemWeight" name="weight" class="form-control" placeholder="Ê¨äÈáç"
                            required>
                        <div style="margin-top: 10px; display: flex; justify-content: flex-end; gap: 10px;">
                            <button type="button" class="btn btn-secondary"
                                onclick="document.getElementById('editBoxItemModal').style.display='none'">ÂèñÊ∂à</button>
                            <button type="submit" class="btn btn-primary">ÂÑ≤Â≠ò</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Transaction Management -->
        <div id="transactions" class="tab-content" style="display:none;">
            <h3>‰∫§ÊòìÁ¥ÄÈåÑ</h3>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>ÊúÉÂì°</th>
                        <th>È°ûÂûã</th>
                        <th>ÈáëÈ°ç</th>
                        <th>ÊèèËø∞</th>
                        <th>ÊôÇÈñì</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="tx : ${transactions}">
                        <td th:text="${tx.id}">1</td>
                        <td th:text="${tx.member != null ? tx.member.username : 'Unknown'}">User</td>
                        <td th:text="${tx.type}">PURCHASE</td>
                        <td th:text="${tx.amount}" th:style="${tx.amount > 0 ? 'color:green' : 'color:red'}">100</td>
                        <td th:text="${tx.description}">Desc</td>
                        <td th:text="${#temporals.format(tx.timestamp, 'yyyy-MM-dd HH:mm')}">Time</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Activity Management -->
        <div id="activities" class="tab-content" style="display:none;">
            <h3>Ê¥ªÂãïÁÆ°ÁêÜ</h3>
            <div class="card" style="padding: 20px; margin-bottom: 20px;">
                <h4>Êñ∞Â¢ûÊ¥ªÂãï</h4>
                <form th:action="@{/admin/activities}" method="post" th:object="${newActivity}">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <input type="text" name="title" placeholder="Ê®ôÈ°å" class="form-control" required />
                        <input type="text" name="type" placeholder="È°ûÂûã (‰æãÂ¶Ç: SALE)" class="form-control" required />
                        <input type="datetime-local" name="startDate" class="form-control" placeholder="ÈñãÂßãÊôÇÈñì" />
                        <input type="datetime-local" name="expiryDate" class="form-control" placeholder="ÁµêÊùüÊôÇÈñì" />
                        <input type="text" name="imageUrl" placeholder="ÂúñÁâá URL" class="form-control" />
                        <textarea name="description" placeholder="ÂÖßÂÆπ" class="form-control"
                            style="grid-column: span 2"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary" style="margin-top: 10px;">Êñ∞Â¢û</button>
                </form>
            </div>
            <table>
                <thead>
                    <tr>
                        <th>Ê®ôÈ°å</th>
                        <th>È°ûÂûã</th>
                        <th>ÈñãÂßãÊôÇÈñì</th>
                        <th>ÁµêÊùüÊôÇÈñì</th>
                        <th>ÁãÄÊÖã</th>
                        <th>Êìç‰Ωú</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="act : ${activities}">
                        <td th:text="${act.title}">Title</td>
                        <td th:text="${act.type}">SALE</td>
                        <td
                            th:text="${act.startDate != null ? #temporals.format(act.startDate, 'yyyy-MM-dd HH:mm') : '-'}">
                            Start</td>
                        <td
                            th:text="${act.expiryDate != null ? #temporals.format(act.expiryDate, 'yyyy-MM-dd HH:mm') : '-'}">
                            End</td>
                        <td>
                            <form th:action="@{/admin/activities/toggle/{id}(id=${act.id})}" method="post"
                                style="margin:0;"
                                onsubmit="if(![[${act.active}]]) return true; return confirm('Á¢∫ÂÆöË¶ÅÈóúÈñâÊ¥ªÂãïÂóéÔºü');">
                                <button type="submit" class="btn btn-sm"
                                    th:classappend="${act.active ? 'btn-success' : 'btn-secondary'}"
                                    th:text="${act.active ? 'ÂïüÁî®' : 'ÂÅúÁî®'}">Active</button>
                            </form>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-info"
                                th:onclick="editActivity([[${act.id}]], '[[${act.title}]]', '[[${act.description}]]', '[[${act.type}]]', '[[${act.startDate}]]', '[[${act.expiryDate}]]')">‚úèÔ∏è</button>
                            <form th:action="@{/admin/activities/delete/{id}(id=${act.id})}" method="post"
                                style="display:inline;" onsubmit="return confirm('Á¢∫ÂÆöÂà™Èô§Ôºü');">
                                <button type="submit" style="background:none;border:none;cursor:pointer;"
                                    title="Âà™Èô§">üóëÔ∏è</button>
                            </form>
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- Edit Activity Modal -->
            <div id="editActivityModal" class="modal"
                style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5);">
                <div class="card" style="margin: 10% auto; width: 50%; padding: 20px;">
                    <h4>Á∑®ËºØÊ¥ªÂãï</h4>
                    <form th:action="@{/admin/activities/update}" method="post">
                        <input type="hidden" id="editActId" name="id">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <input type="text" id="editActTitle" name="title" placeholder="Ê®ôÈ°å" class="form-control"
                                required />
                            <input type="text" id="editActType" name="type" placeholder="È°ûÂûã" class="form-control"
                                required />
                            <input type="datetime-local" id="editActStart" name="startDate" class="form-control"
                                placeholder="ÈñãÂßãÊôÇÈñì" />
                            <input type="datetime-local" id="editActEnd" name="expiryDate" class="form-control"
                                placeholder="ÁµêÊùüÊôÇÈñì" />
                            <textarea id="editActDesc" name="description" placeholder="ÂÖßÂÆπ" class="form-control"
                                style="grid-column: span 2"></textarea>
                        </div>
                        <div style="margin-top: 10px; display: flex; justify-content: flex-end; gap: 10px;">
                            <button type="button" class="btn btn-secondary"
                                onclick="document.getElementById('editActivityModal').style.display='none'">ÂèñÊ∂à</button>
                            <button type="submit" class="btn btn-primary">ÂÑ≤Â≠ò</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Coupon Management -->
        <div id="coupons" class="tab-content" style="display:none;">
            <h3>ÂÑ™ÊÉ†Âà∏ÁÆ°ÁêÜ</h3>
            <div class="card" style="padding: 20px; margin-bottom: 20px;">
                <h4>Êñ∞Â¢ûÂÑ™ÊÉ†Âà∏</h4>
                <form th:action="@{/admin/coupons/create}" method="post">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <input type="text" name="name" placeholder="ÂêçÁ®±" class="form-control" required />
                        <input type="text" name="code" placeholder="‰ª£Á¢º (ÈÅ∏Â°´)" class="form-control" />
                        <select name="type" class="form-control" required>
                            <option value="DISCOUNT_PERCENT">ÂïÜÂìÅÊäòÊâ£ (ÊäòÊï∏)</option>
                            <option value="DISCOUNT_AMOUNT">ÂïÜÂìÅË≥ºÁâ©Èáë (ÈáëÈ°ç)</option>
                            <option value="MYSTERY_BOX_FREE">ÊäΩÁçéÊ¨°Êï∏ (Ê¨°)</option>
                        </select>
                        <input type="number" step="0.01" name="value" placeholder="Êï∏ÂÄº (Â¶Ç 0.9 Êàñ 100)"
                            class="form-control" required />
                        <input type="datetime-local" name="validFrom" class="form-control" required title="ÁîüÊïàÊó•" />
                        <input type="datetime-local" name="validUntil" class="form-control" required title="Âà∞ÊúüÊó•" />
                        <input type="text" name="description" placeholder="ÊèèËø∞" class="form-control"
                            style="grid-column: span 2;" />
                    </div>
                    <button type="submit" class="btn btn-primary" style="margin-top: 10px;">Âª∫Á´ãÂÑ™ÊÉ†Âà∏</button>
                </form>
            </div>

            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>ÂêçÁ®±</th>
                        <th>È°ûÂûã</th>
                        <th>Êï∏ÂÄº</th>
                        <th>ÊúâÊïàÊúü</th>
                        <th>Êìç‰Ωú</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="coupon : ${coupons}">
                        <td th:text="${coupon.id}"></td>
                        <td th:text="${coupon.name}"></td>
                        <td th:text="${coupon.type}"></td>
                        <td th:text="${coupon.value}"></td>
                        <td>
                            <span th:text="${#temporals.format(coupon.validFrom, 'yyyy-MM-dd HH:mm')}"></span> ~
                            <span th:text="${#temporals.format(coupon.validUntil, 'yyyy-MM-dd HH:mm')}"></span>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-info"
                                th:onclick="openDistributeModal([[${coupon.id}]], '[[${coupon.name}]]')">Ê¥æÁôº</button>
                        </td>
                    </tr>
                </tbody>
            </table>

            <!-- Distribute Modal -->
            <div id="distributeCouponModal" class="modal"
                style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5);">
                <div class="card" style="margin: 10% auto; width: 40%; padding: 20px;">
                    <h4 id="distributeTitle">Ê¥æÁôºÂÑ™ÊÉ†Âà∏</h4>

                    <div style="margin-bottom: 20px; border-bottom: 1px solid #eee; padding-bottom: 10px;">
                        <h5>ÊåâÁ≠âÁ¥öÊ¥æÁôº</h5>
                        <form th:action="@{/admin/coupons/distribute/level}" method="post"
                            style="display:flex; gap:10px;">
                            <input type="hidden" id="distCouponIdLevel" name="couponId">
                            <select name="levelId" class="form-control" required>
                                <option value="">ÈÅ∏ÊìáÁ≠âÁ¥ö</option>
                                <option th:each="lvl : ${memberLevels}" th:value="${lvl.id}" th:text="${lvl.name}">
                                </option>
                            </select>
                            <button type="submit" class="btn btn-primary">Ê¥æÁôº</button>
                        </form>
                    </div>

                    <div>
                        <h5>ÊåâÊúÉÂì°IDÊ¥æÁôº</h5>
                        <form th:action="@{/admin/coupons/distribute/member}" method="post"
                            style="display:flex; gap:10px;">
                            <input type="hidden" id="distCouponIdMember" name="couponId">
                            <input type="number" name="memberId" placeholder="ÊúÉÂì°ID" class="form-control" required>
                            <button type="submit" class="btn btn-primary">Ê¥æÁôº</button>
                        </form>
                    </div>

                    <div style="margin-top: 20px; text-align: right;">
                        <button type="button" class="btn btn-secondary"
                            onclick="document.getElementById('distributeCouponModal').style.display='none'">ÈóúÈñâ</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Platform Management -->
        <div id="platform" class="tab-content" style="display:none;">
            <h3>Âπ≥Âè∞ÁÆ°ÁêÜ</h3>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <!-- Carousel Management -->
                <div class="card" style="grid-column: span 2;">
                    <div class="card-header bg-info text-white">‰∏ªÁï´Èù¢Ëº™Êí≠</div>
                    <div class="card-body">
                        <form id="form-carousel-create" th:action="@{/admin/platform/carousel/create}" method="post"
                            class="row g-3">
                            <div class="col-md-5">
                                <input type="text" name="imageUrl" class="form-control" placeholder="ÂúñÁâáÁ∂≤ÂùÄ" required>
                            </div>
                            <div class="col-md-5">
                                <input type="text" name="linkUrl" class="form-control" placeholder="ÈÄ£ÁµêÁ∂≤ÂùÄ (ÈÅ∏Â°´)">
                            </div>
                            <div class="col-md-2">
                                <button type="submit" class="btn btn-primary w-100">Êñ∞Â¢û</button>
                            </div>
                        </form>
                        <table class="table mt-3">
                            <thead>
                                <tr>
                                    <th>ÂúñÁâá</th>
                                    <th>ÈÄ£Áµê</th>
                                    <th>Êìç‰Ωú</th>
                                </tr>
                            </thead>
                            <tbody id="tbody-carousel">
                                <tr th:each="slide : ${carouselSlides}">
                                    <td><img th:src="${slide.imageUrl}" style="height: 50px;"></td>
                                    <td th:text="${slide.linkUrl}"></td>
                                    <td>
                                        <button class="btn btn-sm btn-danger btn-delete-carousel"
                                            th:data-id="${slide.id}">Âà™Èô§</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- New Arrivals Management -->
                <div class="card">
                    <div class="card-header bg-success text-white">Êñ∞ÂìÅÈ†ÖÁõÆ (New Arrivals)</div>
                    <div class="card-body">
                        <form id="form-new-arrival" th:action="@{/admin/platform/featured/add}" method="post"
                            class="row g-3">
                            <input type="hidden" name="type" value="NEW_ARRIVAL">
                            <div class="col-md-8">
                                <select name="productId" class="form-control" required>
                                    <option value="">ÈÅ∏ÊìáÂïÜÂìÅ</option>
                                    <option th:each="prod : ${products}" th:value="${prod.id}" th:text="${prod.name}">
                                    </option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <input type="number" name="sortOrder" class="form-control" placeholder="ÊéíÂ∫è" value="0">
                            </div>
                            <div class="col-md-2">
                                <button type="submit" class="btn btn-primary w-100">Êñ∞Â¢û</button>
                            </div>
                        </form>
                        <table class="table mt-3">
                            <thead>
                                <tr>
                                    <th>ÂïÜÂìÅÂêçÁ®±</th>
                                    <th>ÊéíÂ∫è</th>
                                    <th>Êìç‰Ωú</th>
                                </tr>
                            </thead>
                            <tbody id="tbody-new-arrival">
                                <tr th:each="item : ${newArrivals}">
                                    <td th:text="${item.product.name}"></td>
                                    <td th:text="${item.sortOrder}"></td>
                                    <td>
                                        <button class="btn btn-sm btn-danger btn-delete-featured"
                                            th:data-id="${item.id}">ÁßªÈô§</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Best Sellers Management -->
                <div class="card">
                    <div class="card-header bg-warning text-dark">ÁÜ±Èä∑ÊéíË°åÊ¶ú (Best Sellers)</div>
                    <div class="card-body">
                        <form id="form-best-seller" th:action="@{/admin/platform/featured/add}" method="post"
                            class="row g-3">
                            <input type="hidden" name="type" value="BEST_SELLER">
                            <div class="col-md-8">
                                <select name="productId" class="form-control" required>
                                    <option value="">ÈÅ∏ÊìáÂïÜÂìÅ</option>
                                    <option th:each="prod : ${products}" th:value="${prod.id}" th:text="${prod.name}">
                                    </option>
                                </select>
                            </div>
                            <div class="col-md-2">
                                <input type="number" name="sortOrder" class="form-control" placeholder="ÊéíÂ∫è" value="0">
                            </div>
                            <div class="col-md-2">
                                <button type="submit" class="btn btn-primary w-100">Êñ∞Â¢û</button>
                            </div>
                        </form>
                        <table class="table mt-3">
                            <thead>
                                <tr>
                                    <th>ÂïÜÂìÅÂêçÁ®±</th>
                                    <th>ÊéíÂ∫è</th>
                                    <th>Êìç‰Ωú</th>
                                </tr>
                            </thead>
                            <tbody id="tbody-best-seller">
                                <tr th:each="item : ${bestSellers}">
                                    <td th:text="${item.product.name}"></td>
                                    <td th:text="${item.sortOrder}"></td>
                                    <td>
                                        <button class="btn btn-sm btn-danger btn-delete-featured"
                                            th:data-id="${item.id}">ÁßªÈô§</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Push Notifications -->
                <div class="card" style="grid-column: span 2;">
                    <div class="card-header bg-danger text-white">ÂèäÊôÇÊé®ÈÄÅ (Push Notifications)</div>
                    <div class="card-body">
                        <form id="form-notification" th:action="@{/admin/platform/notification/send}" method="post">
                            <div class="mb-3">
                                <label>Ê®ôÈ°å</label>
                                <input type="text" name="title" class="form-control" required>
                            </div>
                            <div class="mb-3">
                                <label>ÂÖßÂÆπ</label>
                                <textarea name="content" class="form-control" rows="3" required></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary">ÁôºÈÄÅÈÄöÁü•</button>
                        </form>

                        <h5 class="mt-4">Ê≠∑Âè≤Á¥ÄÈåÑ</h5>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>ÊôÇÈñì</th>
                                    <th>Ê®ôÈ°å</th>
                                    <th>ÂÖßÂÆπ</th>
                                </tr>
                            </thead>
                            <tbody id="tbody-notification">
                                <tr th:each="notif : ${notifications}">
                                    <td th:text="${#temporals.format(notif.createdAt, 'yyyy-MM-dd HH:mm')}"></td>
                                    <td th:text="${notif.title}"></td>
                                    <td th:text="${notif.content}"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

            </div>
        </div>

        <!-- Logs -->
        <div id="logs" class="tab-content" style="display:none;">
            <h3>Êìç‰ΩúÊó•Ë™å</h3>
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Êìç‰ΩúËÄÖ</th>
                        <th>Âãï‰Ωú</th>
                        <th>Ë©≥ÊÉÖ</th>
                        <th>Ë´ãÊ±ÇÂèÉÊï∏</th>
                        <th>ÊôÇÈñì</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="log : ${logs}">
                        <td th:text="${log.id}">1</td>
                        <td th:text="${log.adminUsername}">User</td>
                        <td th:text="${log.action}">LOGIN</td>
                        <td th:text="${log.details}">Success</td>
                        <td th:text="${log.requestParams}"
                            style="max-width: 200px; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"
                            title="${log.requestParams}">Params</td>
                        <td
                            th:text="${log.timestamp != null ? #temporals.format(log.timestamp, 'yyyy-MM-dd HH:mm') : ''}">
                            Time</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Edit Member Level Modal -->
        <div id="editLevelModal" class="modal"
            style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5);">
            <div class="card" style="margin: 10% auto; width: 40%; padding: 20px;">
                <h4>Á∑®ËºØÁ≠âÁ¥ö</h4>
                <form th:action="@{/admin/member-levels/update}" method="post">
                    <input type="hidden" id="editLvlId" name="id">
                    <div style="display: grid; gap: 10px;">
                        <label>Á≠âÁ¥öÂêçÁ®±</label>
                        <input type="text" id="editLvlName" name="name" class="form-control" required />
                        <label>ÊéíÂ∫è</label>
                        <input type="number" id="editLvlSort" name="sortOrder" class="form-control" required />
                        <label>Á¥ØÁ©çÂÑ≤ÂÄºÈñÄÊ™ª</label>
                        <input type="number" step="0.01" id="editLvlThreshold" name="threshold" class="form-control"
                            required />
                        <label>ÊØèÊúàÁçéÂãµ</label>
                        <input type="text" id="editLvlReward" name="monthlyReward" class="form-control" />
                        <label>ÁãÄÊÖã</label>
                        <select id="editLvlEnabled" name="enabled" class="form-control">
                            <option value="true">ÂïüÁî®</option>
                            <option value="false">ÂÅúÁî®</option>
                        </select>
                    </div>
                    <div style="margin-top: 10px; display: flex; justify-content: flex-end; gap: 10px;">
                        <button type="button" class="btn btn-secondary"
                            onclick="document.getElementById('editLevelModal').style.display='none'">ÂèñÊ∂à</button>
                        <button type="submit" class="btn btn-primary">ÂÑ≤Â≠ò</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Edit Member Modal -->
        <div id="editMemberModal" class="modal"
            style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5);">
            <div class="card" style="margin: 10% auto; width: 40%; padding: 20px;">
                <h4>Á∑®ËºØÊúÉÂì°</h4>
                <form th:action="@{/admin/members/update}" method="post">
                    <input type="hidden" id="editMemberId" name="id">
                    <div style="display: grid; gap: 10px;">
                        <label>Email</label>
                        <input type="text" id="editMemberEmail" name="email" class="form-control" />
                        <label>Êö±Á®±</label>
                        <input type="text" id="editMemberName" name="nickname" class="form-control" />
                        <label>ÁãÄÊÖã</label>
                        <select id="editMemberStatus" name="enabled" class="form-control">
                            <option value="true">ÂïüÁî®</option>
                            <option value="false">ÂÅúÁî®</option>
                        </select>
                        <label>Á≠âÁ¥ö</label>
                        <select id="editMemberLevel" name="level" class="form-control">
                            <option value="">ÈÅ∏ÊìáÁ≠âÁ¥ö</option>
                            <option th:each="lvl : ${memberLevels}" th:value="${lvl.id}" th:text="${lvl.name}"></option>
                        </select>
                    </div>
                    <div style="margin-top: 10px; display: flex; justify-content: flex-end; gap: 10px;">
                        <button type="button" class="btn btn-secondary"
                            onclick="document.getElementById('editMemberModal').style.display='none'">ÂèñÊ∂à</button>
                        <button type="submit" class="btn btn-primary">ÂÑ≤Â≠ò</button>
                    </div>
                </form>
            </div>
        </div>

        <script>
            function editLevel(id, name, sort, threshold, reward, enabled) {
                document.getElementById('editLvlId').value = id;
                document.getElementById('editLvlName').value = name;
                document.getElementById('editLvlSort').value = sort;
                document.getElementById('editLvlThreshold').value = threshold;
                document.getElementById('editLvlReward').value = reward;
                document.getElementById('editLvlEnabled').value = enabled;
                document.getElementById('editLevelModal').style.display = 'block';
            }

            function openTab(tabName) {
                var i;
                var x = document.getElementsByClassName("tab-content");
                for (i = 0; i < x.length; i++) {
                    x[i].style.display = "none";
                }
                document.getElementById(tabName).style.display = "block";

                // Update URL without reloading
                const url = new URL(window.location);
                url.searchParams.set('tab', tabName);
                window.history.pushState({}, '', url);
            }

            function loadSubCats(catId) {
                if (!catId) return;
                fetch('/admin/api/subcategories/' + catId)
                    .then(response => response.json())
                    .then(data => {
                        let select = document.getElementById('prodSubCategory');
                        select.innerHTML = '<option value="">ÈÅ∏ÊìáÂ≠êÂàÜÈ°û</option>';
                        data.forEach(sub => {
                            let option = document.createElement('option');
                            option.value = sub.name; // Storing Name as Product entity uses string
                            option.text = sub.name;
                            select.appendChild(option);
                        });
                    });
            }

            function editMember(id, email, name, enabled, level) {
                document.getElementById('editMemberId').value = id;
                document.getElementById('editMemberEmail').value = email;
                document.getElementById('editMemberName').value = name;
                document.getElementById('editMemberStatus').value = enabled;
                document.getElementById('editMemberLevel').value = level;
                document.getElementById('editMemberModal').style.display = 'block';
            }

            function showHistory(memberId) {
                alert("History Modal feature coming soon for Member ID: " + memberId);
                // Implementation for Modal fetch would go here
            }

            // On Load: Check for 'tab' param
            document.addEventListener('DOMContentLoaded', (event) => {
                const urlParams = new URLSearchParams(window.location.search);
                const tab = urlParams.get('tab');
                if (tab) {
                    openTab(tab);
                }
            });
            function editTheme(id, name, price) {
                document.getElementById('editThemeId').value = id;
                document.getElementById('editThemeName').value = name;
                document.getElementById('editThemePrice').value = price;
                document.getElementById('editThemeModal').style.display = 'block';
            }

            function editActivity(id, title, desc, type, start, end) {
                document.getElementById('editActId').value = id;
                document.getElementById('editActTitle').value = title;
                document.getElementById('editActDesc').value = desc;
                document.getElementById('editActType').value = type;
                document.getElementById('editActStart').value = start ? start : '';
                document.getElementById('editActEnd').value = end ? end : '';
                document.getElementById('editActivityModal').style.display = 'block';
            }

            function editCategory(id, name) {
                document.getElementById('editCatId').value = id;
                document.getElementById('editCatName').value = name;
                document.getElementById('editCategoryModal').style.display = 'block';
            }

            function editSubCategory(id, name) {
                document.getElementById('editSubCatId').value = id;
                document.getElementById('editSubCatName').value = name;
                document.getElementById('editSubCategoryModal').style.display = 'block';
            }

            function editBoxItem(id, name, value, weight) {
                document.getElementById('editBoxItemId').value = id;
                document.getElementById('editBoxItemName').value = name;
                document.getElementById('editBoxItemValue').value = value;
                document.getElementById('editBoxItemWeight').value = weight;
                document.getElementById('editBoxItemModal').style.display = 'block';
            }
            function openDistributeModal(id, name) {
                document.getElementById('distCouponIdLevel').value = id;
                document.getElementById('distCouponIdMember').value = id;
                document.getElementById('distributeTitle').innerText = 'Ê¥æÁôºÂÑ™ÊÉ†Âà∏ - ' + name;
                document.getElementById('distributeCouponModal').style.display = 'block';
            }
            // Platform Management AJAX
            document.addEventListener('DOMContentLoaded', function () {
                function handleForm(formId, tbodyId, rowBuilder) {
                    const form = document.getElementById(formId);
                    if (!form) return;
                    form.addEventListener('submit', async function (e) {
                        e.preventDefault();
                        const formData = new FormData(form);
                        const params = new URLSearchParams();
                        for (const pair of formData.entries()) { params.append(pair[0], pair[1]); }

                        try {
                            const res = await fetch(form.action, { method: 'POST', body: params });
                            const json = await res.json();
                            if (json.success) {
                                alert('Êìç‰ΩúÊàêÂäü');
                                if (tbodyId && rowBuilder) {
                                    const tbody = document.getElementById(tbodyId);
                                    const tr = document.createElement('tr');
                                    tr.innerHTML = rowBuilder(json);
                                    tbody.appendChild(tr);
                                } else {
                                    location.reload();
                                }
                                form.reset();
                            } else {
                                alert('Â§±Êïó: ' + json.message);
                            }
                        } catch (err) {
                            console.error(err);
                            alert('ÁôºÁîüÈåØË™§');
                        }
                    });
                }

                // Carousel
                handleForm('form-carousel-create', 'tbody-carousel', (json) => {
                    const s = json.slide;
                    return `<td><img src="${s.imageUrl}" style="height: 50px;"></td>
                            <td>${s.linkUrl || ''}</td>
                            <td><button class="btn btn-sm btn-danger btn-delete-carousel" data-id="${s.id}">Âà™Èô§</button></td>`;
                });

                // New Arrival
                handleForm('form-new-arrival', 'tbody-new-arrival', (json) => {
                    const i = json.item;
                    return `<td>${json.productName}</td>
                            <td>${i.sortOrder}</td>
                            <td><button class="btn btn-sm btn-danger btn-delete-featured" data-id="${i.id}">ÁßªÈô§</button></td>`;
                });

                // Best Seller
                handleForm('form-best-seller', 'tbody-best-seller', (json) => {
                    const i = json.item;
                    return `<td>${json.productName}</td>
                            <td>${i.sortOrder}</td>
                            <td><button class="btn btn-sm btn-danger btn-delete-featured" data-id="${i.id}">ÁßªÈô§</button></td>`;
                });

                // Notification
                handleForm('form-notification', null, null);

                // Deletes
                document.addEventListener('click', async function (e) {
                    let endpoint = '';
                    let id = '';
                    if (e.target.classList.contains('btn-delete-carousel')) {
                        endpoint = '/admin/platform/carousel/delete/';
                        id = e.target.getAttribute('data-id');
                    } else if (e.target.classList.contains('btn-delete-featured')) {
                        endpoint = '/admin/platform/featured/delete/';
                        id = e.target.getAttribute('data-id');
                    }

                    if (endpoint && id) {
                        e.preventDefault();
                        if (!confirm('Á¢∫ÂÆöÂà™Èô§Ôºü')) return;
                        try {
                            const res = await fetch(endpoint + id, { method: 'POST' });
                            const json = await res.json();
                            if (json.success) {
                                e.target.closest('tr').remove();
                            } else {
                                alert('Âà™Èô§Â§±Êïó: ' + json.message);
                            }
                        } catch (err) {
                            console.error(err);
                            alert('Âà™Èô§ÈåØË™§');
                        }
                    }
                });
            });
        </script>
    </div>
</body>

</html>